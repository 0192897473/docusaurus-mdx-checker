"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[3759],{9892:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var n=t(4246),r=t(1670);const a={id:"snapshot-testing",title:"Test Snapshot"},o=void 0,i={unversionedId:"snapshot-testing",id:"version-29.4/snapshot-testing",title:"Test Snapshot",description:"Les tests snapshot sont tr\xe8s utiles pour s'assurer que votre UI ne change pas soudainement.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-29.4/SnapshotTesting.md",sourceDirName:".",slug:"/snapshot-testing",permalink:"/fr/docs/29.4/snapshot-testing",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/project/jest-v2/fr",tags:[],version:"29.4",frontMatter:{id:"snapshot-testing",title:"Test Snapshot"},sidebar:"docs",previous:{title:"Plus de ressources",permalink:"/fr/docs/29.4/more-resources"},next:{title:"Un exemple Async",permalink:"/fr/docs/29.4/tutorial-async"}},l={},c=[{value:"Test de snapshot avec Jest",id:"test-de-snapshot-avec-jest",level:2},{value:"Mise \xe0 jour des snapshots",id:"mise-\xe0-jour-des-snapshots",level:3},{value:"Mode snapshot interactif",id:"mode-snapshot-interactif",level:3},{value:"Snapshots en ligne",id:"snapshots-en-ligne",level:3},{value:"Comparateurs de propri\xe9t\xe9s",id:"comparateurs-de-propri\xe9t\xe9s",level:3},{value:"Bonnes pratiques",id:"bonnes-pratiques",level:2},{value:"1. Traitez les snapshots comme du code",id:"1-traitez-les-snapshots-comme-du-code",level:3},{value:"2. Les tests doivent \xeatre d\xe9terministes",id:"2-les-tests-doivent-\xeatre-d\xe9terministes",level:3},{value:"3. Utilisez des noms de snapshot descriptifs",id:"3-utilisez-des-noms-de-snapshot-descriptifs",level:3},{value:"Foire aux questions",id:"foire-aux-questions",level:2},{value:"Les snapshots sont-ils \xe9crits automatiquement sur les syst\xe8mes d&#39;int\xe9gration continue (CI) ?",id:"les-snapshots-sont-ils-\xe9crits-automatiquement-sur-les-syst\xe8mes-dint\xe9gration-continue-ci-",level:3},{value:"Les fichiers de snapshot doivent-ils \xeatre commit\xe9s ?",id:"les-fichiers-de-snapshot-doivent-ils-\xeatre-commit\xe9s-",level:3},{value:"Est-ce que le test snapshot fonctionne uniquement avec les composants React ?",id:"est-ce-que-le-test-snapshot-fonctionne-uniquement-avec-les-composants-react-",level:3},{value:"Quelle est la diff\xe9rence entre le test snapshot et le test de r\xe9gression visuelle ?",id:"quelle-est-la-diff\xe9rence-entre-le-test-snapshot-et-le-test-de-r\xe9gression-visuelle-",level:3},{value:"Est-ce que les tests snapshot remplacent les tests unitaires?",id:"est-ce-que-les-tests-snapshot-remplacent-les-tests-unitaires",level:3},{value:"Quelles sont les performances des tests snapshot en termes de vitesse et de taille des fichiers g\xe9n\xe9r\xe9s ?",id:"quelles-sont-les-performances-des-tests-snapshot-en-termes-de-vitesse-et-de-taille-des-fichiers-g\xe9n\xe9r\xe9s-",level:3},{value:"Comment r\xe9soudre les conflits dans les fichiers snapshot ?",id:"comment-r\xe9soudre-les-conflits-dans-les-fichiers-snapshot-",level:3},{value:"Est-il possible d&#39;appliquer les principes du d\xe9veloppement pilot\xe9 par les tests avec des tests snapshot ?",id:"est-il-possible-dappliquer-les-principes-du-d\xe9veloppement-pilot\xe9-par-les-tests-avec-des-tests-snapshot-",level:3},{value:"La couverture du code fonctionne-t-elle avec les tests snapshot ?",id:"la-couverture-du-code-fonctionne-t-elle-avec-les-tests-snapshot-",level:3}];function d(e){const s=Object.assign({p:"p",h2:"h2",a:"a",pre:"pre",code:"code",admonition:"admonition",h3:"h3",img:"img",br:"br"},(0,r.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:"Les tests snapshot sont tr\xe8s utiles pour s'assurer que votre UI ne change pas soudainement."}),"\n",(0,n.jsx)(s.p,{children:"Un cas typique de test snapshot, c'est qu'il rend un composant de l'interface utilisateur, prend un snapshot, puis le compare \xe0 un fichier snapshot de r\xe9f\xe9rence stock\xe9 \xe0 c\xf4t\xe9 du test. Le test \xe9chouera si les deux snapshots ne correspondent pas : soit le changement est inattendu, soit le snapshot de r\xe9f\xe9rence doit \xeatre mis \xe0 jour avec la nouvelle version du composant UI."}),"\n",(0,n.jsx)(s.h2,{id:"test-de-snapshot-avec-jest",children:"Test de snapshot avec Jest"}),"\n",(0,n.jsxs)(s.p,{children:["Une approche similaire peut \xeatre adopt\xe9e lorsqu'il s'agit de tester vos composants React. Au lieu d'effectuer le rendu de l'interface graphique, ce qui n\xe9cessiterait de construire l'ensemble de l'application, vous pouvez utiliser un moteur de rendu de test pour g\xe9n\xe9rer rapidement une valeur s\xe9rialisable pour votre arborescence React. Consider this ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/examples/snapshot/__tests__/link.test.js",children:"example test"})," for a ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/examples/snapshot/Link.js",children:"Link component"}),":"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-tsx",children:"import renderer from 'react-test-renderer';\nimport Link from '../Link';\n\nit('rend correctement', () => {\n  const tree = renderer\n    .create(<Link page=\"http://www.facebook.com\">Facebook</Link>)\n    .toJSON();\n  expect(tree).toMatchSnapshot();\n});\n"})}),"\n",(0,n.jsxs)(s.p,{children:["The first time this test is run, Jest creates a ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/examples/snapshot/__tests__/__snapshots__/link.test.js.snap",children:"snapshot file"})," that looks like this:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:'exports[`rend correctement 1`] = `\n<a\n  className="normal"\n  href="http://www.facebook.com"\n  onMouseEnter={[Function]}\n  onMouseLeave={[Function]}\n>\n  Facebook\n</a>\n`;\n'})}),"\n",(0,n.jsxs)(s.p,{children:["L'artefact du snapshot doit \xeatre committ\xe9 en m\xeame temps que les changements de code, et r\xe9vis\xe9 dans le cadre de votre processus de revue de code. Jest uses ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/tree/main/packages/pretty-format",children:"pretty-format"})," to make snapshots human-readable during code review. Lors des prochains tests, Jest comparera la sortie rendue avec le snapshot pr\xe9c\xe9dent. S'ils sont identiques, le test est r\xe9ussi. S'ils ne sont pas identiques, soit l'ex\xe9cuteur de test a trouv\xe9 un bogue dans votre code (dans le composant ",(0,n.jsx)(s.code,{children:"<Link>"})," dans ce cas) qui doit \xeatre corrig\xe9, soit l'impl\xe9mentation a chang\xe9 et le snapshot doit \xeatre mis \xe0 jour."]}),"\n",(0,n.jsx)(s.admonition,{title:"remarque",type:"note",children:(0,n.jsxs)(s.p,{children:["The snapshot is directly scoped to the data you render \u2013 in our example the ",(0,n.jsx)(s.code,{children:"<Link>"})," component with ",(0,n.jsx)(s.code,{children:"page"})," prop passed to it. This implies that even if any other file has missing props (say, ",(0,n.jsx)(s.code,{children:"App.js"}),") in the ",(0,n.jsx)(s.code,{children:"<Link>"})," component, it will still pass the test as the test doesn't know the usage of ",(0,n.jsx)(s.code,{children:"<Link>"})," component and it's scoped only to the ",(0,n.jsx)(s.code,{children:"Link.js"}),". De plus, le rendu du m\xeame composant avec des props diff\xe9rentes dans d'autres tests de snapshot n'affectera pas le premier, car les tests ne se connaissent pas entre eux."]})}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["Vous trouverez plus d'informations sur le fonctionnement des tests snapshot et les raisons pour lesquelles nous les avons cr\xe9\xe9s dans ",(0,n.jsx)(s.a,{href:"/blog/2016/07/27/jest-14",children:"l'article du blog"}),". Nous vous recommandons de lire ",(0,n.jsx)(s.a,{href:"http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/",children:"cette note de blog"})," pour avoir une bonne id\xe9e du moment o\xf9 vous devriez utiliser le test de snapshot. Nous vous recommandons \xe9galement de regarder cette ",(0,n.jsx)(s.a,{href:"https://egghead.io/lessons/javascript-use-jest-s-snapshot-testing-feature?pl=testing-javascript-with-jest-a36c4074",children:"vid\xe9o de egghead"})," sur le test des snapshots avec Jest."]})}),"\n",(0,n.jsx)(s.h3,{id:"mise-\xe0-jour-des-snapshots",children:"Mise \xe0 jour des snapshots"}),"\n",(0,n.jsx)(s.p,{children:"Il est facile de rep\xe9rer l'\xe9chec d'un test snapshot apr\xe8s l'introduction d'un bogue. Lorsque c'est le cas, corrigez le probl\xe8me et assurez-vous que vos tests snapshot passent \xe0 nouveau. Maintenant, parlons du cas o\xf9 un test snapshot \xe9choue en raison d'un changement d\xe9lib\xe9r\xe9 de l'impl\xe9mentation."}),"\n",(0,n.jsx)(s.p,{children:"Une telle situation peut se produire si nous modifions intentionnellement l'adresse vers laquelle pointe le composant Link dans notre exemple."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-tsx",children:"// Mise \xe0 jour du cas de test avec un lien vers une adresse diff\xe9rente\nit('renders correctly', () => {\n  const tree = renderer\n    .create(<Link page=\"http://www.instagram.com\">Instagram</Link>)\n    .toJSON();\n  expect(tree).toMatchSnapshot();\n});\n"})}),"\n",(0,n.jsx)(s.p,{children:"Dans ce cas, Jest affichera cette sortie :"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:t(5310).Z+"",width:"1844",height:"1246"})}),"\n",(0,n.jsx)(s.p,{children:"Puisque nous venons de mettre \xe0 jour notre composant pour qu'il pointe vers une adresse diff\xe9rente, il est l\xe9gitime de s'attendre \xe0 des changements dans le snapshot de ce composant. Notre sc\xe9nario de test snapshot \xe9choue car le snapshot de notre composant modifi\xe9 ne correspond plus \xe0 l'artefact snapshot de ce sc\xe9nario de test."}),"\n",(0,n.jsx)(s.p,{children:"Pour r\xe9soudre ce probl\xe8me, nous devrons mettre \xe0 jour nos artefacts de snapshot. Vous pouvez ex\xe9cuter Jest avec un indicateur qui lui dira de reg\xe9n\xe9rer des snapshots :"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"jest --updateSnapshot\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Allez-y et acceptez les changements en ex\xe9cutant la commande ci-dessus. Vous pouvez \xe9galement utiliser l'indicateur \xe9quivalent avec un seul caract\xe8re ",(0,n.jsx)(s.code,{children:"-u"}),", si vous pr\xe9f\xe9rez pour g\xe9n\xe9rer \xe0 nouveau des snapshots. Cela permettra de reg\xe9n\xe9rer les artefacts de snapshot pour tous les tests de snapshot qui ont \xe9chou\xe9. Si d'autres tests de snapshots \xe9chouaient \xe0 cause d'un bug involontaire, nous devons corriger le bug avant de g\xe9n\xe9rer \xe0 nouveau des snapshots pour \xe9viter d'enregistrer des snapshots du comportement bogu\xe9."]}),"\n",(0,n.jsxs)(s.p,{children:["Si vous souhaitez limiter les cas de test snapshot qui sont reg\xe9n\xe9r\xe9s, vous pouvez passer un indicateur suppl\xe9mentaire ",(0,n.jsx)(s.code,{children:"--testNamePattern"})," pour r\xe9enregistrer les snapshots uniquement pour les tests qui correspondent au pattern."]}),"\n",(0,n.jsxs)(s.p,{children:["You can try out this functionality by cloning the ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/tree/main/examples/snapshot",children:"snapshot example"}),", modifying the ",(0,n.jsx)(s.code,{children:"Link"})," component, and running Jest."]}),"\n",(0,n.jsx)(s.h3,{id:"mode-snapshot-interactif",children:"Mode snapshot interactif"}),"\n",(0,n.jsx)(s.p,{children:"Les snapshots qui ont \xe9chou\xe9 peuvent \xe9galement \xeatre mis \xe0 jour de mani\xe8re interactive en mode watch\xa0:"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:t(2003).Z+"",width:"2052",height:"1048"})}),"\n",(0,n.jsx)(s.p,{children:"Une fois que vous entrez dans le mode snapshot interactif, Jest vous guidera \xe0 travers les snapshots qui ont \xe9chou\xe9, un test \xe0 la fois, et vous donnera l'opportunit\xe9 de r\xe9examiner les r\xe9sultats qui ont \xe9chou\xe9."}),"\n",(0,n.jsx)(s.p,{children:"\xc0 partir de l\xe0, vous pouvez choisir de mettre \xe0 jour ce snapshot ou de passer au suivant :"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:t(5015).Z+"",width:"1106",height:"697"})}),"\n",(0,n.jsx)(s.p,{children:"Une fois que vous avez termin\xe9, Jest vous donnera un r\xe9sum\xe9 avant de revenir au mode watch\xa0:"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:t(6439).Z+"",width:"1452",height:"400"})}),"\n",(0,n.jsx)(s.h3,{id:"snapshots-en-ligne",children:"Snapshots en ligne"}),"\n",(0,n.jsxs)(s.p,{children:["Les snapshots en ligne se comportent de mani\xe8re identique aux snapshots externes (fichiers ",(0,n.jsx)(s.code,{children:".snap"}),"), sauf que les valeurs des snapshots sont r\xe9\xe9crites automatiquement dans le code source. Cela signifie que vous pouvez b\xe9n\xe9ficier des avantages des snapshots g\xe9n\xe9r\xe9s automatiquement sans avoir \xe0 passer par un fichier externe pour vous assurer que la valeur correcte a \xe9t\xe9 \xe9crite."]}),"\n",(0,n.jsx)(s.p,{children:"Exemple\xa0:"}),"\n",(0,n.jsxs)(s.p,{children:["Tout d'abord, vous \xe9crivez un test, appelant ",(0,n.jsx)(s.code,{children:".toMatchInlineSnapshot()"})," sans arguments\xa0:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-tsx",children:"it('rend correctement', () => {\n  const tree = renderer\n    .create(<Link page=\"https://example.com\">Example Site</Link>)\n    .toJSON();\n  expect(tree).toMatchInlineSnapshot();\n});\n"})}),"\n",(0,n.jsxs)(s.p,{children:["La prochaine fois que vous ex\xe9cuterez Jest, ",(0,n.jsx)(s.code,{children:"tree"})," sera \xe9valu\xe9, et un snapshot sera \xe9crit comme argument \xe0 ",(0,n.jsx)(s.code,{children:"toMatchInlineSnapshot"})," :"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-tsx",children:'it(\'rend correctement\', () => {\n  const tree = renderer\n    .create(<Link page="https://example.com">Example Site</Link>)\n    .toJSON();\n  expect(tree).toMatchInlineSnapshot(`\n<a\n  className="normal"\n  href="https://example.com"\n  onMouseEnter={[Function]}\n  onMouseLeave={[Function]}\n>\n  Example Site\n</a>\n`);\n});\n'})}),"\n",(0,n.jsxs)(s.p,{children:["C'est tout ce qu'il y a \xe0 faire\xa0! Vous pouvez m\xeame mettre \xe0 jour les instantan\xe9s avec ",(0,n.jsx)(s.code,{children:"--updateSnapshot"})," ou en utilisant le code ",(0,n.jsx)(s.code,{children:"u"})," en mode ",(0,n.jsx)(s.code,{children:"--watch"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Par d\xe9faut, Jest g\xe8re l'\xe9criture des snapshots dans votre code source. Cependant, si vous utilisez ",(0,n.jsx)(s.a,{href:"https://www.npmjs.com/package/prettier",children:"prettier"})," dans votre projet, Jest le d\xe9tectera et d\xe9l\xe9guera \xe0 la place le travail \xe0 prettier (y compris en honorant votre configuration)."]}),"\n",(0,n.jsx)(s.h3,{id:"comparateurs-de-propri\xe9t\xe9s",children:"Comparateurs de propri\xe9t\xe9s"}),"\n",(0,n.jsx)(s.p,{children:"Souvent, certains champs de l'objet que vous souhaitez snapshoter sont g\xe9n\xe9r\xe9s (comme les ID et les Dates). Si vous essayez de prendre un snapshot de ces objets, ils feront \xe9chouer le snapshot \xe0 chaque ex\xe9cution :"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:'it(\'will fail every time\', () => {\n  const user = {\n    createdAt: new Date(),\n    id: Math.floor(Math.random() * 20),\n    name: \'LeBron James\',\n  };\n\n  expect(user).toMatchSnapshot();\n});\n\n// Snapshot\nexports[`will fail every time 1`] = `\n{\n  "createdAt": 2018-05-19T23:36:09.816Z,\n  "id": 3,\n  "name": "LeBron James",\n}\n`;\n'})}),"\n",(0,n.jsx)(s.p,{children:"Pour ces cas, Jest permet de fournir un comparateur asym\xe9trique pour n'importe quelle propri\xe9t\xe9. Ces comparateurs sont v\xe9rifi\xe9s avant que le snapshot ne soit \xe9crit ou test\xe9, puis ils sont enregistr\xe9s dans le fichier snapshot \xe0 la place de la valeur re\xe7ue\xa0:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:'it(\'will check the matchers and pass\', () => {\n  const user = {\n    createdAt: new Date(),\n    id: Math.floor(Math.random() * 20),\n    name: \'LeBron James\',\n  };\n\n  expect(user).toMatchSnapshot({\n    createdAt: expect.any(Date),\n    id: expect.any(Number),\n  });\n});\n\n// Snapshot\nexports[`will check the matchers and pass 1`] = `\n{\n  "createdAt": Any<Date>,\n  "id": Any<Number>,\n  "name": "LeBron James",\n}\n`;\n'})}),"\n",(0,n.jsx)(s.p,{children:"Toute valeur donn\xe9e qui n'est pas un comparateur sera v\xe9rifi\xe9e exactement et enregistr\xe9e dans le snapshot\xa0:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"it('v\xe9rifiera les valeurs et passera', () => {\n  const user = {\n    createdAt: new Date(),\n    name: 'Bond... James Bond',\n  };\n\n  expect(user).toMatchSnapshot({\n    createdAt: expect.any(Date),\n    name: 'Bond... James Bond',\n  });\n});\n\n// Snapshot\nexports[`will check the values and pass 1`] = `\n{\n  \"createdAt\": Any<Date>,\n  \"name\": 'Bond... James Bond',\n}\n`;\n"})}),"\n",(0,n.jsxs)(s.admonition,{title:"astuce",type:"tip",children:[(0,n.jsxs)(s.p,{children:["Si le cas concerne une cha\xeene de caract\xe8res et non un objet, alors vous devez remplacer la partie al\xe9atoire de cette cha\xeene vous-m\xeame avant de tester le snapshot.",(0,n.jsx)(s.br,{}),"\n","Vous pouvez utiliser pour cela par exemple ",(0,n.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace",children:(0,n.jsx)(s.code,{children:"replace()"})})," et ",(0,n.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions",children:"les expressions r\xe9guli\xe8res"}),"."]}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:'const randomNumber = Math.round(Math.random() * 100);\nconst stringWithRandomData = `<div id="${randomNumber}">Lorem ipsum</div>`;\nconst stringWithConstantData = stringWithRandomData.replace(/id="\\d+"/, 123);\nexpect(stringWithConstantData).toMatchSnapshot();\n'})}),(0,n.jsxs)(s.p,{children:["Une autre m\xe9thode consiste \xe0 ",(0,n.jsx)(s.a,{href:"/fr/docs/29.4/mock-functions",children:"simuler"})," la biblioth\xe8que responsable de la g\xe9n\xe9ration de la partie al\xe9atoire du code dont vous faites un snapshot."]})]}),"\n",(0,n.jsx)(s.h2,{id:"bonnes-pratiques",children:"Bonnes pratiques"}),"\n",(0,n.jsx)(s.p,{children:"Les snapshots sont un outil fantastique pour identifier les changements d'interface inattendus au sein de votre application - que cette interface soit une r\xe9ponse API, une interface utilisateur, des journaux ou des messages d'erreur. Comme pour toute strat\xe9gie de test, il existe des bonnes pratiques que vous devez conna\xeetre et des directives \xe0 suivre pour les utiliser efficacement."}),"\n",(0,n.jsx)(s.h3,{id:"1-traitez-les-snapshots-comme-du-code",children:"1. Traitez les snapshots comme du code"}),"\n",(0,n.jsx)(s.p,{children:"Committez les snapshots et examinez-les dans le cadre de votre processus r\xe9gulier de r\xe9vision du code. Cela signifie que vous devez traiter les snapshots comme vous le feriez pour tout autre type de test ou de code dans votre projet."}),"\n",(0,n.jsx)(s.p,{children:"Assurez-vous que vos snapshots sont lisibles en les gardant bien cibl\xe9s, courts, et en utilisant des outils qui appliquent ces conventions stylistiques."}),"\n",(0,n.jsxs)(s.p,{children:["Comme mentionn\xe9 pr\xe9c\xe9demment, Jest utilise ",(0,n.jsx)(s.a,{href:"https://yarnpkg.com/en/package/pretty-format",children:(0,n.jsx)(s.code,{children:"pretty-format"})})," pour rendre les snapshots lisibles par l'homme, mais vous pouvez trouver utile d'introduire des outils suppl\xe9mentaires, comme ",(0,n.jsx)(s.a,{href:"https://yarnpkg.com/en/package/eslint-plugin-jest",children:(0,n.jsx)(s.code,{children:"eslint-plugin-jest"})})," avec son option ",(0,n.jsx)(s.a,{href:"https://github.com/jest-community/eslint-plugin-jest/blob/main/docs/rules/no-large-snapshots.md",children:(0,n.jsx)(s.code,{children:"no-large-snapshots"})}),", ou ",(0,n.jsx)(s.a,{href:"https://yarnpkg.com/en/package/snapshot-diff",children:(0,n.jsx)(s.code,{children:"snapshot-diff"})})," avec sa fonctionnalit\xe9 de comparaison de snapshots de composants, pour favoriser des commits d'assertions courts et cibl\xe9s."]}),"\n",(0,n.jsx)(s.p,{children:"L'objectif est de faciliter l'examen des snapshots dans les pull requests, et de lutter contre l'habitude de r\xe9g\xe9n\xe9rer les snapshots lorsque les suites de tests \xe9chouent au lieu d'examiner les causes profondes de leur \xe9chec."}),"\n",(0,n.jsx)(s.h3,{id:"2-les-tests-doivent-\xeatre-d\xe9terministes",children:"2. Les tests doivent \xeatre d\xe9terministes"}),"\n",(0,n.jsx)(s.p,{children:"Vos tests doivent \xeatre d\xe9terministes. L'ex\xe9cution des m\xeames tests plusieurs fois sur un composant qui n'a pas chang\xe9 devrait produire les m\xeames r\xe9sultats \xe0 chaque fois. Il vous incombe de veiller \xe0 ce que les snapshots g\xe9n\xe9r\xe9s n'incluent pas de donn\xe9es sp\xe9cifiques \xe0 la plateforme ou d'autres donn\xe9es non d\xe9terministes."}),"\n",(0,n.jsxs)(s.p,{children:["For example, if you have a ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/examples/snapshot/Clock.js",children:"Clock"})," component that uses ",(0,n.jsx)(s.code,{children:"Date.now()"}),", the snapshot generated from this component will be different every time the test case is run. Dans ce cas, nous pouvons ",(0,n.jsx)(s.a,{href:"/fr/docs/29.4/mock-functions",children:"simuler la m\xe9thode Date.now()"})," pour renvoyer une valeur coh\xe9rente \xe0 chaque fois que le test est ex\xe9cut\xe9\xa0:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",children:"Date.now = jest.fn(() => 1482363367071);\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Maintenant, \xe0 chaque fois que le sc\xe9nario de test snapshot s'ex\xe9cute, ",(0,n.jsx)(s.code,{children:"Date.now()"})," retournera ",(0,n.jsx)(s.code,{children:"1482363367071"})," de mani\xe8re coh\xe9rente. Ainsi, le m\xeame snapshot sera g\xe9n\xe9r\xe9 pour ce composant, quel que soit le moment o\xf9 le test est ex\xe9cut\xe9."]}),"\n",(0,n.jsx)(s.h3,{id:"3-utilisez-des-noms-de-snapshot-descriptifs",children:"3. Utilisez des noms de snapshot descriptifs"}),"\n",(0,n.jsx)(s.p,{children:"Efforcez-vous toujours d'utiliser des noms de test et/ou de snapshot descriptifs pour les snapshots. Les meilleurs noms d\xe9crivent le contenu attendu du snapshot. Il est ainsi plus facile pour les relecteurs de v\xe9rifier les snapshots lors de la relecture, et pour quiconque de savoir si un snapshot obsol\xe8te correspond ou non au comportement correct avant la mise \xe0 jour."}),"\n",(0,n.jsx)(s.p,{children:"Par exemple, comparons\xa0:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",children:"exports[`<UserName /> devrait g\xe9rer certains cas de test`] = `null`;\n\nexports[`<UserName /> devrait g\xe9rer un autre cas de test`] = `\n<div>\n  Alan Turing\n</div>\n`;\n"})}),"\n",(0,n.jsx)(s.p,{children:"Avec\xa0:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",children:"exports[`<UserName /> devrait rendre null`] = `null`;\n\nexports[`<UserName /> devrait rendre Alan Turing`] = `\n<div>\n  Alan Turing\n</div>\n`;\n"})}),"\n",(0,n.jsx)(s.p,{children:"Puisque la deuxi\xe8me version d\xe9crit exactement ce que l'on attend \xe0 la sortie, il est plus facile de voir quand c'est faux\xa0:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",children:"exports[`<UserName /> devrait rendre null`] = `\n<div>\n  Alan Turing\n</div>\n`;\n\nexports[`<UserName /> devrait rendre Alan Turing`] = `null`;\n"})}),"\n",(0,n.jsx)(s.h2,{id:"foire-aux-questions",children:"Foire aux questions"}),"\n",(0,n.jsx)(s.h3,{id:"les-snapshots-sont-ils-\xe9crits-automatiquement-sur-les-syst\xe8mes-dint\xe9gration-continue-ci-",children:"Les snapshots sont-ils \xe9crits automatiquement sur les syst\xe8mes d'int\xe9gration continue (CI) ?"}),"\n",(0,n.jsxs)(s.p,{children:["Non, \xe0 partir de Jest 20, les snapshots dans Jest ne sont pas automatiquement \xe9crits lorsque Jest est ex\xe9cut\xe9 dans un syst\xe8me CI sans passer explicitement ",(0,n.jsx)(s.code,{children:"--updateSnapshot"}),". On s'attend \xe0 ce que tous les snapshots fassent partie du code qui est ex\xe9cut\xe9 sur CI et puisque les nouveaux snapshots passent automatiquement, ils ne devraient pas passer un test ex\xe9cut\xe9 sur un syst\xe8me CI. Il est recommand\xe9 de toujours livrer tous les snapshots et de les conserver dans le contr\xf4le de version."]}),"\n",(0,n.jsx)(s.h3,{id:"les-fichiers-de-snapshot-doivent-ils-\xeatre-commit\xe9s-",children:"Les fichiers de snapshot doivent-ils \xeatre commit\xe9s ?"}),"\n",(0,n.jsx)(s.p,{children:"Oui, tous les fichiers snapshot doivent \xeatre committ\xe9s avec les modules qu'ils couvrent et leurs tests. Ils doivent \xeatre consid\xe9r\xe9s comme faisant partie d'un test, de la m\xeame mani\xe8re que la valeur de toute autre assertion dans Jest. En fait, les snapshots repr\xe9sentent l'\xe9tat des modules sources \xe0 un moment donn\xe9 dans le temps. De cette fa\xe7on, lorsque les modules sources sont modifi\xe9s, Jest peut savoir ce qui a chang\xe9 par rapport \xe0 la version pr\xe9c\xe9dente. Il peut \xe9galement fournir beaucoup de contexte suppl\xe9mentaire lors de la r\xe9vision du code gr\xe2ce auquel les r\xe9viseurs peuvent mieux \xe9tudier vos changements."}),"\n",(0,n.jsx)(s.h3,{id:"est-ce-que-le-test-snapshot-fonctionne-uniquement-avec-les-composants-react-",children:"Est-ce que le test snapshot fonctionne uniquement avec les composants React ?"}),"\n",(0,n.jsxs)(s.p,{children:["Les composants ",(0,n.jsx)(s.a,{href:"/fr/docs/29.4/tutorial-react",children:"React"})," et ",(0,n.jsx)(s.a,{href:"/fr/docs/29.4/tutorial-react-native",children:"React Native"})," constituent un bon cas d'utilisation pour les tests snapshot. Cependant, les snapshots peuvent capturer n'importe quelle valeur s\xe9rialisable et devraient \xeatre utilis\xe9s chaque fois que l'objectif est de tester si la sortie est correcte. Le d\xe9p\xf4t Jest contient de nombreux exemples de tests de la sortie de Jest lui-m\xeame, de la sortie de la biblioth\xe8que d'assertions de Jest ainsi que des messages du journal de diverses parties de la base de code Jest. See an example of ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/e2e/__tests__/console.test.ts",children:"snapshotting CLI output"})," in the Jest repo."]}),"\n",(0,n.jsx)(s.h3,{id:"quelle-est-la-diff\xe9rence-entre-le-test-snapshot-et-le-test-de-r\xe9gression-visuelle-",children:"Quelle est la diff\xe9rence entre le test snapshot et le test de r\xe9gression visuelle ?"}),"\n",(0,n.jsxs)(s.p,{children:["Les tests snapshot et les tests de r\xe9gression visuelle sont deux fa\xe7ons distinctes de tester les interfaces utilisateur, et ils servent des objectifs diff\xe9rents. Les outils de test de r\xe9gression visuelle prennent des captures d'\xe9cran de pages web et comparent les images r\xe9sultantes pixel par pixel. Avec le test snapshot, les valeurs sont s\xe9rialis\xe9es, stock\xe9es dans des fichiers texte et compar\xe9es \xe0 l'aide d'un algorithme de comparaison. Il y a diff\xe9rents compromis \xe0 prendre en compte et nous avons list\xe9 les raisons pour lesquelles les tests instantan\xe9s ont \xe9t\xe9 construits dans le ",(0,n.jsx)(s.a,{href:"/blog/2016/07/27/jest-14#why-snapshot-testing",children:"blog de Jest"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"est-ce-que-les-tests-snapshot-remplacent-les-tests-unitaires",children:"Est-ce que les tests snapshot remplacent les tests unitaires?"}),"\n",(0,n.jsx)(s.p,{children:"Le test snapshot n'est qu'une des 20 assertions qui sont livr\xe9es avec Jest. L'objectif des tests snapshot n'est pas de remplacer les tests unitaires existants, mais d'apporter une valeur ajout\xe9e et de rendre les tests plus faciles. Dans certains sc\xe9narios, les tests snapshot peuvent potentiellement supprimer le besoin de tests unitaires pour un ensemble particulier de fonctionnalit\xe9s (par exemple, les composants React), mais ils peuvent \xe9galement fonctionner ensemble."}),"\n",(0,n.jsx)(s.h3,{id:"quelles-sont-les-performances-des-tests-snapshot-en-termes-de-vitesse-et-de-taille-des-fichiers-g\xe9n\xe9r\xe9s-",children:"Quelles sont les performances des tests snapshot en termes de vitesse et de taille des fichiers g\xe9n\xe9r\xe9s ?"}),"\n",(0,n.jsxs)(s.p,{children:["Jest a \xe9t\xe9 r\xe9\xe9crit dans un souci de performance, et les tests snapshots ne font pas exception. Les snapshots \xe9tant stock\xe9s dans des fichiers texte, cette m\xe9thode de test est rapide et fiable. Jest g\xe9n\xe8re un nouveau fichier pour chaque fichier de test qui appelle le comparateur ",(0,n.jsx)(s.code,{children:"toMatchSnapshot"}),". La taille des snapshots est assez minime : pour preuve, la taille de tous les fichiers snapshots dans la base de code Jest elle-m\xeame est inf\xe9rieure \xe0 300 Ko."]}),"\n",(0,n.jsx)(s.h3,{id:"comment-r\xe9soudre-les-conflits-dans-les-fichiers-snapshot-",children:"Comment r\xe9soudre les conflits dans les fichiers snapshot ?"}),"\n",(0,n.jsx)(s.p,{children:"Les fichiers snapshot doivent toujours repr\xe9senter l'\xe9tat actuel des modules qu'ils couvrent. Par cons\xe9quent, si vous fusionnez deux branches et rencontrez un conflit dans les fichiers snapshot, vous pouvez soit r\xe9soudre le conflit manuellement, soit mettre \xe0 jour le fichier snapshot en ex\xe9cutant Jest et en inspectant le r\xe9sultat."}),"\n",(0,n.jsx)(s.h3,{id:"est-il-possible-dappliquer-les-principes-du-d\xe9veloppement-pilot\xe9-par-les-tests-avec-des-tests-snapshot-",children:"Est-il possible d'appliquer les principes du d\xe9veloppement pilot\xe9 par les tests avec des tests snapshot ?"}),"\n",(0,n.jsx)(s.p,{children:"Bien qu'il soit possible d'\xe9crire les fichiers snapshot manuellement, cela n'est g\xe9n\xe9ralement pas envisageable. Les snapshots aident \xe0 d\xe9terminer si la sortie des modules couverts par les tests est modifi\xe9e, plut\xf4t que de donner des conseils pour concevoir le code en premier lieu."}),"\n",(0,n.jsx)(s.h3,{id:"la-couverture-du-code-fonctionne-t-elle-avec-les-tests-snapshot-",children:"La couverture du code fonctionne-t-elle avec les tests snapshot ?"}),"\n",(0,n.jsx)(s.p,{children:"Oui, ainsi qu'avec n'importe quel autre test."})]})}const u=function(e={}){const{wrapper:s}=Object.assign({},(0,r.ah)(),e.components);return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(d,e)})):d(e)}},5310:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/failedSnapshotTest-754bd8c54c17338fe046c6273fd3f9d1.png"},2003:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/interactiveSnapshot-58ae38e9cae13140c56d8472453f0595.png"},6439:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/interactiveSnapshotDone-59ee291ee320accbc4bfc4f33b22638a.png"},5015:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/interactiveSnapshotUpdate-a17d8d77f94702048b4d0e0e4c580719.gif"},1670:(e,s,t)=>{t.d(s,{Zo:()=>i,ah:()=>a});var n=t(7378);const r=n.createContext({});function a(e){const s=n.useContext(r);return n.useMemo((()=>"function"==typeof e?e(s):{...s,...e}),[s,e])}const o={};function i({components:e,children:s,disableParentContext:t}){let i;return i=t?"function"==typeof e?e({}):e||o:a(e),n.createElement(r.Provider,{value:i},s)}}}]);