"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[2296],{4090:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var s=t(4246),o=t(1670);const a={id:"setup-teardown",title:"\u5b89\u88c5\u548c\u79fb\u9664"},c=void 0,r={unversionedId:"setup-teardown",id:"version-29.6/setup-teardown",title:"\u5b89\u88c5\u548c\u79fb\u9664",description:"\u5199\u6d4b\u8bd5\u7684\u65f6\u5019\u4f60\u7ecf\u5e38\u9700\u8981\u5728\u8fd0\u884c\u6d4b\u8bd5\u524d\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\uff0c\u548c\u5728\u8fd0\u884c\u6d4b\u8bd5\u540e\u8fdb\u884c\u4e00\u4e9b\u6536\u5c3e\u5de5\u4f5c\u3002 Jest \u63d0\u4f9b\u8f85\u52a9\u51fd\u6570\u6765\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u3002",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/version-29.6/SetupAndTeardown.md",sourceDirName:".",slug:"/setup-teardown",permalink:"/zh-Hans/docs/setup-teardown",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/project/jest-v2/zh-CN",tags:[],version:"29.6",frontMatter:{id:"setup-teardown",title:"\u5b89\u88c5\u548c\u79fb\u9664"},sidebar:"docs",previous:{title:"\u6d4b\u8bd5\u5f02\u6b65\u4ee3\u7801",permalink:"/zh-Hans/docs/asynchronous"},next:{title:"\u6a21\u62df\u51fd\u6570",permalink:"/zh-Hans/docs/mock-functions"}},i={},l=[{value:"Repeating Setup",id:"repeating-setup",level:2},{value:"\u4e00\u6b21\u6027\u8bbe\u7f6e",id:"\u4e00\u6b21\u6027\u8bbe\u7f6e",level:2},{value:"\u4f5c\u7528\u57df",id:"\u4f5c\u7528\u57df",level:2},{value:"\u6267\u884c\u987a\u5e8f",id:"\u6267\u884c\u987a\u5e8f",level:2},{value:"\u901a\u7528\u5efa\u8bae",id:"\u901a\u7528\u5efa\u8bae",level:2}];function d(e){const n=Object.assign({p:"p",h2:"h2",code:"code",pre:"pre",a:"a",em:"em",admonition:"admonition"},(0,o.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u5199\u6d4b\u8bd5\u7684\u65f6\u5019\u4f60\u7ecf\u5e38\u9700\u8981\u5728\u8fd0\u884c\u6d4b\u8bd5\u524d\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\uff0c\u548c\u5728\u8fd0\u884c\u6d4b\u8bd5\u540e\u8fdb\u884c\u4e00\u4e9b\u6536\u5c3e\u5de5\u4f5c\u3002 Jest \u63d0\u4f9b\u8f85\u52a9\u51fd\u6570\u6765\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"repeating-setup",children:"Repeating Setup"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u6709\u4e00\u4e9b\u8981\u4e3a\u591a\u6b21\u6d4b\u8bd5\u91cd\u590d\u8bbe\u7f6e\u7684\u5de5\u4f5c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"beforeEach"})," \u548c ",(0,s.jsx)(n.code,{children:"afterEach"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u6211\u4eec\u8003\u8651\u4e00\u4e9b\u4e0e\u57ce\u5e02\u4fe1\u606f\u6570\u636e\u5e93\u8fdb\u884c\u4ea4\u4e92\u7684\u6d4b\u8bd5\u3002 \u4f60\u5fc5\u987b\u5728\u6bcf\u4e2a\u6d4b\u8bd5\u4e4b\u524d\u8c03\u7528\u65b9\u6cd5 ",(0,s.jsx)(n.code,{children:"initializeCityDatabase()"})," \uff0c\u540c\u65f6\u5fc5\u987b\u5728\u6bcf\u4e2a\u6d4b\u8bd5\u540e\uff0c\u8c03\u7528\u65b9\u6cd5 ",(0,s.jsx)(n.code,{children:"clearCityDatabase()"}),"\u3002 \u4f60\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"beforeEach(() => {\n  initializeCityDatabase();\n});\n\nafterEach(() => {\n  clearCityDatabase();\n});\n\ntest('city database has Vienna', () => {\n  expect(isCity('Vienna')).toBeTruthy();\n});\n\ntest('city database has San Juan', () => {\n  expect(isCity('San Juan')).toBeTruthy();\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"beforeEach"})," \u548c ",(0,s.jsx)(n.code,{children:"afterEach"})," \u80fd\u591f\u901a\u8fc7\u4e0e",(0,s.jsx)(n.a,{href:"/zh-Hans/docs/asynchronous",children:" \u5f02\u6b65\u4ee3\u7801\u6d4b\u8bd5"})," \u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406\u5f02\u6b65\u4ee3\u7801 \u2014 \u2014 \u4ed6\u4eec\u53ef\u4ee5\u91c7\u53d6 ",(0,s.jsx)(n.code,{children:"done"})," \u53c2\u6570\u6216\u8fd4\u56de\u4e00\u4e2a promise\u3002 \u4f8b\u5982\uff0c\u5982\u679c ",(0,s.jsx)(n.code,{children:"initializeCityDatabase()"})," \u8fd4\u56de\u89e3\u51b3\u6570\u636e\u5e93\u521d\u59cb\u5316\u65f6\u7684 promise \uff0c\u6211\u4eec\u4f1a\u60f3\u8fd4\u56de\u8fd9\u4e00 promise\ufe30"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"beforeEach(() => {\n  return initializeCityDatabase();\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u4e00\u6b21\u6027\u8bbe\u7f6e",children:"\u4e00\u6b21\u6027\u8bbe\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ea\u9700\u8981\u5728\u6587\u4ef6\u7684\u5f00\u5934\u505a\u4e00\u6b21\u8bbe\u7f6e\u3002 \u5982\u679c\u8fd9\u4e2a\u901a\u7528\u8bbe\u7f6e\u662f\u5f02\u6b65\u7684\uff0c\u5c31\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u6ca1\u529e\u6cd5\u6bcf\u4e2a\u7528\u4f8b\u90fd\u8bbe\u7f6e\u4e00\u904d\uff0c\u8fd9\u6837\u6027\u80fd\u8fd8\u5f88\u5dee\u3002 Jest provides ",(0,s.jsx)(n.code,{children:"beforeAll"})," and ",(0,s.jsx)(n.code,{children:"afterAll"})," hooks to handle this situation."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, if both ",(0,s.jsx)(n.code,{children:"initializeCityDatabase()"})," and ",(0,s.jsx)(n.code,{children:"clearCityDatabase()"})," returned promises, and the city database could be reused between tests, we could change our test code to:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"beforeAll(() => {\n  return initializeCityDatabase();\n});\n\nafterAll(() => {\n  return clearCityDatabase();\n});\n\ntest('city database has Vienna', () => {\n  expect(isCity('Vienna')).toBeTruthy();\n});\n\ntest('city database has San Juan', () => {\n  expect(isCity('San Juan')).toBeTruthy();\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u4f5c\u7528\u57df",children:"\u4f5c\u7528\u57df"}),"\n",(0,s.jsxs)(n.p,{children:["\u9876\u5c42\u7684 ",(0,s.jsx)(n.code,{children:"before*"})," \u548c ",(0,s.jsx)(n.code,{children:"after*"})," hook \u51fd\u6570\u4f1a\u5e94\u7528\u4e8e\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u6761\u6d4b\u8bd5 \u5728 ",(0,s.jsx)(n.code,{children:"describe"})," \u5757\u4e2d\u58f0\u660e\u7684 hook \u51fd\u6570\uff0c\u53ea\u4f1a\u4f5c\u7528\u4e8e ",(0,s.jsx)(n.code,{children:"describe"})," \u4e2d\u7684\u6d4b\u8bd5"]}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u4e0d\u4ec5\u6709\u4e00\u4e2a\u57ce\u5e02\u7684\u6570\u636e\u5e93\uff0c\u8fd8\u6709\u4e00\u4e2a\u98df\u54c1\u6570\u636e\u5e93\u3002 \u6211\u4eec\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u6d4b\u8bd5\u505a\u4e0d\u540c\u7684\u8bbe\u7f6e\ufe30"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Applies to all tests in this file\nbeforeEach(() => {\n  return initializeCityDatabase();\n});\n\ntest('city database has Vienna', () => {\n  expect(isCity('Vienna')).toBeTruthy();\n});\n\ntest('city database has San Juan', () => {\n  expect(isCity('San Juan')).toBeTruthy();\n});\n\ndescribe('matching cities to foods', () => {\n  // Applies only to tests in this describe block\n  beforeEach(() => {\n    return initializeFoodDatabase();\n  });\n\n  test('Vienna <3 veal', () => {\n    expect(isValidCityFoodPair('Vienna', 'Wiener Schnitzel')).toBe(true);\n  });\n\n  test('San Juan <3 plantains', () => {\n    expect(isValidCityFoodPair('San Juan', 'Mofongo')).toBe(true);\n  });\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\u9876\u7ea7\u7684",(0,s.jsx)(n.code,{children:"beforeEach"})," \u4f1a\u6bd4 ",(0,s.jsx)(n.code,{children:"describe"})," \u4e2d\u7684",(0,s.jsx)(n.code,{children:"beforeEach"})," \u6267\u884c\u7684\u66f4\u65e9\u3002 \u4e0b\u9762\u7684\u4ee3\u7801\u4e5f\u8bb8\u80fd\u5e2e\u52a9\u4f60\u7406\u89e3\u6240\u6709 hook \u7684\u6267\u884c\u987a\u5e8f\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"beforeAll(() => console.log('1 - beforeAll'));\nafterAll(() => console.log('1 - afterAll'));\nbeforeEach(() => console.log('1 - beforeEach'));\nafterEach(() => console.log('1 - afterEach'));\n\ntest('', () => console.log('1 - test'));\n\ndescribe('Scoped / Nested block', () => {\n  beforeAll(() => console.log('2 - beforeAll'));\n  afterAll(() => console.log('2 - afterAll'));\n  beforeEach(() => console.log('2 - beforeEach'));\n  afterEach(() => console.log('2 - afterEach'));\n\n  test('', () => console.log('2 - test'));\n});\n\n// 1 - beforeAll\n// 1 - beforeEach\n// 1 - test\n// 1 - afterEach\n// 2 - beforeAll\n// 1 - beforeEach\n// 2 - beforeEach\n// 2 - test\n// 2 - afterEach\n// 1 - afterEach\n// 2 - afterAll\n// 1 - afterAll\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6267\u884c\u987a\u5e8f",children:"\u6267\u884c\u987a\u5e8f"}),"\n",(0,s.jsxs)(n.p,{children:["Jest \u4f1a\u5728\u6240\u6709\u771f\u6b63\u7684\u6d4b\u8bd5\u5f00\u59cb",(0,s.jsx)(n.em,{children:"\u4e4b\u524d"}),"\u6267\u884c\u6d4b\u8bd5\u6587\u4ef6\u91cc\u6240\u6709\u7684 describe \u5904\u7406\u7a0b\u5e8f\uff08handlers\uff09\u3002 This is another reason to do setup and teardown inside ",(0,s.jsx)(n.code,{children:"before*"})," and ",(0,s.jsx)(n.code,{children:"after*"})," handlers rather than inside the ",(0,s.jsx)(n.code,{children:"describe"})," blocks. Once the ",(0,s.jsx)(n.code,{children:"describe"})," blocks are complete, by default Jest runs all the tests serially in the order they were encountered in the collection phase, waiting for each to finish and be tidied up before moving on."]}),"\n",(0,s.jsx)(n.p,{children:"\u8003\u8651\u4ee5\u4e0b\u793a\u4f8b\u6d4b\u8bd5\u6587\u4ef6\u548c\u8f93\u51fa\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"describe('describe outer', () => {\n  console.log('describe outer-a');\n\n  describe('describe inner 1', () => {\n    console.log('describe inner 1');\n\n    test('test 1', () => console.log('test 1'));\n  });\n\n  console.log('describe outer-b');\n\n  test('test 2', () => console.log('test 2'));\n\n  describe('describe inner 2', () => {\n    console.log('describe inner 2');\n\n    test('test 3', () => console.log('test 3'));\n  });\n\n  console.log('describe outer-c');\n});\n\n// describe outer-a\n// describe inner 1\n// describe outer-b\n// describe inner 2\n// describe outer-c\n// test 1\n// test 2\n// test 3\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Just like the ",(0,s.jsx)(n.code,{children:"describe"})," and ",(0,s.jsx)(n.code,{children:"test"})," blocks Jest calls the ",(0,s.jsx)(n.code,{children:"before*"})," and ",(0,s.jsx)(n.code,{children:"after*"})," hooks in the order of declaration. Note that the ",(0,s.jsx)(n.code,{children:"after*"})," hooks of the enclosing scope are called first. For example, here is how you can set up and tear down resources which depend on each other:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"beforeEach(() => console.log('connection setup'));\nbeforeEach(() => console.log('database setup'));\n\nafterEach(() => console.log('database teardown'));\nafterEach(() => console.log('connection teardown'));\n\ntest('test 1', () => console.log('test 1'));\n\ndescribe('extra', () => {\n  beforeEach(() => console.log('extra database setup'));\n  afterEach(() => console.log('extra database teardown'));\n\n  test('test 2', () => console.log('test 2'));\n});\n\n// connection setup\n// database setup\n// test 1\n// database teardown\n// connection teardown\n\n// connection setup\n// database setup\n// extra database setup\n// test 2\n// extra database teardown\n// database teardown\n// connection teardown\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsxs)(n.p,{children:["If you are using ",(0,s.jsx)(n.code,{children:"jasmine2"})," test runner, take into account that it calls the ",(0,s.jsx)(n.code,{children:"after*"})," hooks in the reverse order of declaration. To have identical output, the above example should be altered like this:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-diff",children:"  beforeEach(() => console.log('connection setup'));\n+ afterEach(() => console.log('connection teardown'));\n\n  beforeEach(() => console.log('database setup'));\n+ afterEach(() => console.log('database teardown'));\n\n- afterEach(() => console.log('database teardown'));\n- afterEach(() => console.log('connection teardown'));\n\n  // ...\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"\u901a\u7528\u5efa\u8bae",children:"\u901a\u7528\u5efa\u8bae"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u6d4b\u8bd5\u5931\u8d25\uff0c\u7b2c\u4e00\u4ef6\u8981\u68c0\u67e5\u7684\u4e8b\u5c31\u662f\uff0c\u5f53\u4ec5\u8fd0\u884c\u8fd9\u6761\u6d4b\u8bd5\u65f6\uff0c\u5b83\u662f\u5426\u4ecd\u7136\u5931\u8d25\u3002 To run only one test with Jest, temporarily change that ",(0,s.jsx)(n.code,{children:"test"})," command to a ",(0,s.jsx)(n.code,{children:"test.only"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"test.only('this will be the only test that runs', () => {\n  expect(true).toBe(false);\n});\n\ntest('this test will not run', () => {\n  expect('A').toBe('A');\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6d4b\u8bd5\uff0c\u5f53\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u66f4\u5927\u7684\u7528\u4f8b\u4e2d\u7684\u4e00\u90e8\u5206\u65f6\uff0c\u7ecf\u5e38\u8fd0\u884c\u5931\u8d25\uff0c\u4f46\u662f\u5f53\u4f60\u5355\u72ec\u8fd0\u884c\u5b83\u65f6\uff0c\u5e76\u4e0d\u4f1a\u5931\u8d25\uff0c\u6240\u4ee5\u6700\u597d\u8003\u8651\u5176\u4ed6\u6d4b\u8bd5\u5bf9\u8fd9\u4e2a\u6d4b\u8bd5\u7684\u5f71\u54cd\u3002 \u901a\u5e38\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 ",(0,s.jsx)(n.code,{children:"beforeEach"})," \u6765\u6e05\u9664\u4e00\u4e9b\u5171\u4eab\u7684\u72b6\u6001\u6765\u4fee\u590d\u8fd9\u79cd\u95ee\u9898\u3002 \u5982\u679c\u4f60\u4e0d\u786e\u5b9a\u54ea\u4e9b\u5206\u4eab\u7684\u72b6\u6001\u88ab\u4fee\u6539\u4e86\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u5728 ",(0,s.jsx)(n.code,{children:"beforeEach"})," \u6253\u5370\u51fa\u6765\u770b\u770b\u3002"]})]})}const h=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(d,e)})):d(e)}},1670:(e,n,t)=>{t.d(n,{Zo:()=>r,ah:()=>a});var s=t(7378);const o=s.createContext({});function a(e){const n=s.useContext(o);return s.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const c={};function r({components:e,children:n,disableParentContext:t}){let r;return r=t?"function"==typeof e?e({}):e||c:a(e),s.createElement(o.Provider,{value:r},n)}}}]);