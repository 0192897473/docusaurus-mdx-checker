<!doctype html>
<html lang="fr" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v0.0.0-5658">
<title data-rh="true">Performance des tests unitaires JavaScript · Jest</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jestjs.io/fr/img/opengraph.png"><meta data-rh="true" name="twitter:image" content="https://jestjs.io/fr/img/opengraph.png"><meta data-rh="true" property="og:url" content="https://jestjs.io/fr/blog/2016/03/11/javascript-unit-testing-performance"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" property="og:locale:alternate" content="es_ES"><meta data-rh="true" property="og:locale:alternate" content="pt_BR"><meta data-rh="true" property="og:locale:alternate" content="ro"><meta data-rh="true" property="og:locale:alternate" content="ru"><meta data-rh="true" property="og:locale:alternate" content="uk"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Performance des tests unitaires JavaScript · Jest"><meta data-rh="true" name="description" content="Jest exécute des milliers de tests sur Facebook à tout moment, soit par une intégration continue, soit par un appel manuel des ingénieurs pendant le développement. Cela a bien fonctionné pendant des années, même lorsque les personnes travaillant sur Jest ont été transférées vers d&#x27;autres projets au sein de Facebook."><meta data-rh="true" property="og:description" content="Jest exécute des milliers de tests sur Facebook à tout moment, soit par une intégration continue, soit par un appel manuel des ingénieurs pendant le développement. Cela a bien fonctionné pendant des années, même lorsque les personnes travaillant sur Jest ont été transférées vers d&#x27;autres projets au sein de Facebook."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2016-03-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="http://twitter.com/cpojer"><link data-rh="true" rel="icon" href="/fr/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://jestjs.io/fr/blog/2016/03/11/javascript-unit-testing-performance"><link data-rh="true" rel="alternate" href="https://jestjs.io/blog/2016/03/11/javascript-unit-testing-performance" hreflang="en"><link data-rh="true" rel="alternate" href="https://jestjs.io/ja/blog/2016/03/11/javascript-unit-testing-performance" hreflang="ja"><link data-rh="true" rel="alternate" href="https://jestjs.io/es-ES/blog/2016/03/11/javascript-unit-testing-performance" hreflang="es-ES"><link data-rh="true" rel="alternate" href="https://jestjs.io/fr/blog/2016/03/11/javascript-unit-testing-performance" hreflang="fr"><link data-rh="true" rel="alternate" href="https://jestjs.io/pt-BR/blog/2016/03/11/javascript-unit-testing-performance" hreflang="pt-BR"><link data-rh="true" rel="alternate" href="https://jestjs.io/ro/blog/2016/03/11/javascript-unit-testing-performance" hreflang="ro"><link data-rh="true" rel="alternate" href="https://jestjs.io/ru/blog/2016/03/11/javascript-unit-testing-performance" hreflang="ru"><link data-rh="true" rel="alternate" href="https://jestjs.io/uk/blog/2016/03/11/javascript-unit-testing-performance" hreflang="uk"><link data-rh="true" rel="alternate" href="https://jestjs.io/zh-Hans/blog/2016/03/11/javascript-unit-testing-performance" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://jestjs.io/blog/2016/03/11/javascript-unit-testing-performance" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HP439UUSOL-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/fr/blog/rss.xml" title="Jest RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fr/blog/atom.xml" title="Jest Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-44373548-17"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-44373548-17",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Jest" href="/fr/opensearch.xml">

<link rel="icon" href="/fr/img/jest.png">
<link rel="manifest" href="/fr/manifest.json">
<meta name="theme-color" content="#FFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/fr/img/jest.png">
<link rel="mask-icon" href="/fr/img/jest.svg" color="#15c213">
<meta name="msapplication-TileImage" content="/fr/img/jest.png">
<meta name="msapplication-TileColor" content="#000"><link rel="stylesheet" href="/fr/assets/css/styles.3a42a01f.css">
<script src="/fr/assets/js/runtime~main.6cef95e2.js" defer="defer"></script>
<script src="/fr/assets/js/main.c018b917.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><div class="announcementBar_zJRd" style="background-color:#20232a;color:#fff" role="banner"><div class="content_bSb_ announcementBarContent_t7IR">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fr/"><b class="navbar__title text--truncate">Jest</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/fr/docs/getting-started">29.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/fr/docs/next/getting-started">Suivant</a></li><li><a class="dropdown__link" href="/fr/docs/getting-started">29.6</a></li><li><a class="dropdown__link" href="/fr/docs/29.5/getting-started">29.5</a></li><li><a class="dropdown__link" href="/fr/docs/29.4/getting-started">29.4</a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/29.3/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">29.3<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/29.2/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">29.2<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/29.1/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">29.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/29.0/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">29.0<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/28.x/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">28.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/27.x/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">27.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/26.x/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">26.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://jest-archive-august-2023.netlify.app/docs/25.x/getting-started/" target="_blank" rel="noopener noreferrer" class="dropdown__link">25.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archive.jestjs.io/docs/en/24.x/getting-started.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">24.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archive.jestjs.io/docs/en/23.x/getting-started.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">23.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archive.jestjs.io/docs/en/22.x/getting-started.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">22.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/fr/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/fr/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/fr/docs/api">API</a><a class="navbar__item navbar__link" href="/fr/help">Aide</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fr/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_kvP7"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/ja/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li><li><a href="/es-ES/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es-ES">Español</a></li><li><a href="/fr/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">Français</a></li><li><a href="/pt-BR/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="pt-BR">Português (Brasil)</a></li><li><a href="/ro/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ro">Română</a></li><li><a href="/ru/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ru">Русский</a></li><li><a href="/uk/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="uk">Українська</a></li><li><a href="/zh-Hans/blog/2016/03/11/javascript-unit-testing-performance" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/jestjs/jest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Basculer entre le mode sombre et le mode clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et le mode clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_WqAV"><button type="button" class="DocSearch DocSearch-Button" aria-label="Recherche"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Recherche</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_CLW8 thin-scrollbar" aria-label="Navigation dans les articles récents du blog"><div class="sidebarItemTitle_DQfJ margin-bottom--md">Articles récents</div><ul class="sidebarItemList_rvuc clean-list"><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/fr/blog/2022/08/25/jest-29">Jest 29 : Changements de format de snapshot</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/fr/blog/2022/05/11/jest-joins-openjs">Jest rejoint la fondation OpenJS</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/fr/blog/2022/04/25/jest-28">Jest 28 : Perte de poids et compatibilité accrue 🫶</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/fr/blog/2021/05/25/jest-27">Jest 27 : nouvelles valeurs par défaut pour Jest, édition 2021 ⏩</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/fr/blog/2021/03/09/jest-website-upgrade">Mise à niveau du site web de Jest</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Jest exécute des milliers de tests sur Facebook à tout moment, soit par une intégration continue, soit par un appel manuel des ingénieurs pendant le développement. Cela a bien fonctionné pendant des années, même lorsque les personnes travaillant sur Jest ont été transférées vers d&#x27;autres projets au sein de Facebook."><header><h1 class="title_Kdtz" itemprop="headline">Performance des tests unitaires JavaScript</h1><div class="container_iZB2 margin-vert--md"><time datetime="2016-03-11T00:00:00.000Z" itemprop="datePublished">11 mars 2016</time> · <!-- -->11 minutes de lecture</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_v1VX"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="http://twitter.com/cpojer" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Christoph Nakazawa</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Jest exécute des milliers de tests sur Facebook à tout moment, soit par une intégration continue, soit par un appel manuel des ingénieurs pendant le développement. Cela a bien fonctionné pendant des années, même lorsque les personnes travaillant sur Jest ont été transférées vers d&#x27;autres projets au sein de Facebook.</p>
<p>Cependant, à mesure que les ingénieurs ajoutaient de plus en plus de tests, nous avons remarqué que les performances de Jest n&#x27;allaient pas s&#x27;améliorer. En outre, au cours de l&#x27;année dernière, l&#x27;écosystème JavaScript a radicalement changé avec l&#x27;introduction de choses comme npm3 et Babel, ce que nous n&#x27;avions pas anticipé. Nous avons formé une nouvelle équipe de Jest pour traiter tous ces problèmes et nous partagerons nos progrès et nos plans sur ce blog à partir de maintenant.</p>
<p>Jest est un peu différent de la plupart des frameworks de test. Nous l&#x27;avons conçu pour bien fonctionner dans le contexte de l&#x27;infrastructure de Facebook :</p>
<ul>
<li><strong>Monorepo</strong> Sur Facebook, nous avons un énorme monorepo qui contient tout notre code JavaScript. Il y a de nombreuses raisons pour lesquelles cette approche est avantageuse pour nous et il y a un <a href="https://www.youtube.com/watch?v=W71BTkUbdqE" target="_blank" rel="noopener noreferrer">discours génial</a> d&#x27;un ingénieur Google qui met en évidence tous les avantages et inconvénients des monorepos.</li>
<li><strong>La boxe à sable</strong> Une autre fonctionnalité de Jest qui est importante pour Facebook est la façon dont elle virtualise l&#x27;environnement de test et enveloppe <code>nécessite</code> pour exécuter du code sandbox et isoler des tests individuels. Nous travaillons même à rendre Jest plus modulaire pour que nous puissions tirer parti de cette fonctionnalité dans d&#x27;autres cas d&#x27;utilisation non liés aux tests.</li>
<li><strong>providesModule</strong> Si vous avez regardé l&#x27;un de nos projets JavaScript open source avant, vous avez peut-être remarqué que nous utilisons un en-tête <code>@providesModule</code> pour assigner des identifiants globalement uniques aux modules. Cela nécessite des outils personnalisés, mais cela nous permet de référencer des modules sans chemins relatifs, ce qui nous a aidés à avancer incroyablement vite. a évolu é ainsi que notre organisation d&#x27;ingénierie a grandi et a favorisé le partage de code dans toute l&#x27;entreprise. Consultez <a href="https://github.com/facebook/relay/blob/4eae620d86ed7fce1ee463c2fca88eb690d9cbde/src/container/RelayContainer.js#L9" target="_blank" rel="noopener noreferrer">RelayContainer</a> pour un exemple de comment cela fonctionne en pratique. Un inconvénient à cette approche, cependant, est que nous sommes forcés de lire et d&#x27;analyser toute notre base de code JavaScript afin de résoudre une seule requête requise. Cela serait évidemment prohibitif sans mise en cache complète, en particulier pour un processus de courte durée comme Jest.</li>
</ul>
<p>En raison de ces contraintes uniques, Jest ne pourra peut-être jamais être aussi rapide que les autres exécuteurs de test lorsqu&#x27;il s&#x27;exécute sur toute notre suite de tests. Cependant, les ingénieurs ont rarement besoin d&#x27;exécuter Jest sur toute notre suite de tests. Propulsé par une analyse statique dans le projet <a href="https://github.com/facebook/node-haste" target="_blank" rel="noopener noreferrer">node-haste</a> – nous avons pu faire le mode par défaut pour exécuter Jest sur Facebook <code>jest --onlyChanged</code>, ou <code>jest -o</code>. Dans ce mode, nous construisons un graphique de dépendance inversée pour ne trouver que les tests concernés qui doivent être exécutés en fonction des modules qui ont été modifiés.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="planification-optimale-dune-exécution-de-test">Planification optimale d&#x27;une exécution de test<a href="#planification-optimale-dune-exécution-de-test" class="hash-link" aria-label="Direct link to Planification optimale d&#x27;une exécution de test" title="Direct link to Planification optimale d&#x27;une exécution de test">​</a></h2>
<p>La plupart du temps, notre analyse statique détermine que plusieurs tests doivent être exécutés. Le nombre de tests affectés peut aller de quelques tests à des milliers. Afin d&#x27;accélérer ce processus, Jest effectue des parallélisations de tests entre les travailleurs. C&#x27;est génial parce que la majeure partie du développement de Facebook se produit sur des serveurs distants avec de nombreux cœurs de processeur.</p>
<p>Récemment, nous avons remarqué que Jest semblait souvent coincé <em>« En attente de 3 tests »</em> jusqu&#x27;à une minute vers la fin d&#x27;une course. Il s&#x27;est avéré que nous avions quelques tests vraiment lents dans notre base de code qui dominaient l&#x27;exécution. Bien que nous ayons pu accélérer de manière significative ces tests individuels, nous avons également modifié la façon dont Jest planifie le fonctionnement des tests. Auparavant, nous avions l&#x27;habitude de planifier des exécutions de tests basées sur la traversée du système de fichiers, qui était en fait assez aléatoire. Voici un exemple de 11 tests en blocs gris sur deux travailleurs. La taille du bloc est le temps d&#x27;exécution du test :</p>
<p><img loading="lazy" alt="perf-planification de base" src="data:image/png;base64,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" width="1274" height="427" class="img_SS3x"></p>
<p>Nous avons fait un mélange aléatoire de tests rapides et lents, et l&#x27;un de nos tests les plus lents a fini par fonctionner comme presque tous les autres tests ont été terminés, au cours desquels le second worker a été inactif.</p>
<p>Nous avons modifié la planification des tests en fonction de leur taille de fichier, ce qui est généralement un bon proxy pour la durée à laquelle un test va prendre. Un test avec quelques milliers de lignes de code prend probablement plus de temps qu&#x27;un test avec 15 lignes de code. Tandis que cette vitesse accélère le test entier d&#x27;environ 10%, nous avons fini par trouver une meilleure heuristique : maintenant Jest stocke l&#x27;exécution de chaque test dans une cache et lors des exécutions suivantes, il planifie les tests les plus lents à exécuter en premier. Dans l&#x27;ensemble, cela a contribué à améliorer le temps d&#x27;exécution de tous les tests d&#x27;environ 20%.</p>
<p>Voici un exemple du même test avec une meilleure planification :</p>
<p><img loading="lazy" alt="planifications améliorées par tranche" src="data:image/png;base64,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" width="1274" height="427" class="img_SS3x"></p>
<p>Parce que nous lançons d&#x27;abord des tests lents, Jest peut parfois prendre beaucoup de temps pour démarrer – nous n’imprimons les résultats qu’une fois le premier test terminé. Pour l&#x27;avenir, nous prévoyons d&#x27;abord d&#x27;exécuter les tests qui ont échoué précédemment, parce que l&#x27;obtention de cette information aux développeurs le plus rapidement possible importe le plus.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="inline-requires-and-lazy-mocking">Inline Requires and Lazy Mocking<a href="#inline-requires-and-lazy-mocking" class="hash-link" aria-label="Direct link to Inline Requires and Lazy Mocking" title="Direct link to Inline Requires and Lazy Mocking">​</a></h2>
<p>Si vous avez déjà écrit des tests avec Jasmine, ils ressemblent probablement à ceci :</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f6f6"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-js codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#297a29">const</span><span class="token plain"> sum </span><span class="token operator" style="color:#888">=</span><span class="token plain"> </span><span class="token function" style="color:#6b2e85">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#6b2e85">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#6b2e85">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;works&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#6b2e85">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#6b2e85">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#1373c2">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#6b2e85">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copier" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Une chose spéciale que nous faisons dans Jest est de réinitialiser la totalité du registre des modules après chaque test (appelez à <code>il</code>) pour vous assurer que les tests ne dépendent pas les uns des autres. Avant Jest, les tests individuels dépendaient les uns des autres et l&#x27;état interne des modules se divulguait souvent entre eux. Au fur et à mesure que les ingénieurs ont enlevé, réordonné ou refaçonné les tests, certains ont commencé à échouer, ce qui rend difficile pour les gens de comprendre ce qui se passait.</p>
<p>Chaque test de Jest reçoit une nouvelle copie de tous les modules, y compris les nouvelles versions de toutes les dépendances fictives qui prennent beaucoup de temps à générer pour chaque test. Un effet secondaire de ceci est que nous avons dû appeler <code>require</code> manuellement avant chaque test, comme ceci :</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f6f6"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-js codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#297a29">let</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#6b2e85">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#6b2e85">beforeEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sum </span><span class="token operator" style="color:#888">=</span><span class="token plain"> </span><span class="token function" style="color:#6b2e85">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#6b2e85">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;works&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#6b2e85">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#6b2e85">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#1373c2">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#6b2e85">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#6b2e85">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;works too&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// This copy of sum is not the same as in the previous call to `it`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#6b2e85">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#6b2e85">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#1373c2">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#6b2e85">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copier" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Nous avons construit une transformation babel appelée <a href="https://github.com/facebook/fbjs/blob/main/packages/babel-preset-fbjs/plugins/inline-requires.js" target="_blank" rel="noopener noreferrer">inline-requires</a> qui supprime les instructions de haut niveau et les insère dans le code. Par exemple, la ligne <code>const sum = require(&#x27;sum&#x27;);</code> sera retiré du code, mais chaque utilisation de la somme `` dans le fichier sera remplacée par <code>require(&#x27;sum&#x27;)</code>. Avec cette transformation, nous pouvons écrire des tests comme vous vous y attendiez dans Jasmine et le code se transforme en ceci :</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f6f6"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-js codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#6b2e85">describe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#6b2e85">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;works&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#888">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#6b2e85">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#6b2e85">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#c21325">&#x27;sum&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#1373c2">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#6b2e85">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#1373c2">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copier" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Un grand effet secondaire de la ligne exige que nous n&#x27;ayons besoin que des modules que nous utilisons réellement dans le test lui-même, au lieu de tous les modules que nous avons utilisés dans le fichier entier.</p>
<p>Ce qui mène à une autre optimisation : le bouchon paresseux. L&#x27;idée est de bouchonner uniquement les modules à la demande, qui est combiné avec inline nous sauve de bouchonner beaucoup de modules et toutes leurs dépendances récursives.</p>
<p>Nous avons pu mettre à jour tous les tests en utilisant un <a href="https://github.com/cpojer/js-codemod/blob/master/transforms/outline-require.js" target="_blank" rel="noopener noreferrer">codemod</a> en un rien de temps - c&#x27;était un <em>simple</em> 50, 00 changement de code de ligne. Inline nécessite et paresseux mocking a amélioré le temps de test de 50%.</p>
<p>Le plugin babel inline-require est non seulement utile pour Jest mais aussi pour JavaScript normal. Il a été expédié par <a href="https://twitter.com/voideanvalue" target="_blank" rel="noopener noreferrer">Bhuwan</a> à tous les utilisateurs de <a href="http://facebook.com/" target="_blank" rel="noopener noreferrer">facebook.com</a> il y a juste une semaine et a considérablement amélioré le temps de démarrage.</p>
<p>Pour l&#x27;instant, si vous souhaitez utiliser cette transformation dans Jest, vous devrez l&#x27;ajouter manuellement à votre configuration Babel. Nous travaillons sur des moyens de faciliter la mise en œuvre de cette option.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="repo-sync-et-mise-en-cache">Repo-Sync et mise en cache<a href="#repo-sync-et-mise-en-cache" class="hash-link" aria-label="Direct link to Repo-Sync et mise en cache" title="Direct link to Repo-Sync et mise en cache">​</a></h2>
<p>La version open source de Jest était un fork de notre version interne, et nous synchroniserions Jest une fois tous les deux mois. Ce fut un processus manuel douloureux qui nécessitait de corriger de nombreux tests à chaque fois. Nous avons récemment mis à jour Jest et apporté la parité à toutes les plateformes (iOS, Android et web) et avons ensuite activé notre processus de synchronisation. Maintenant, chaque changement de Jest en open source est exécuté contre tous nos tests internes, et il n&#x27;y a qu&#x27;une seule version de Jest qui soit cohérente partout.</p>
<p>La première fonctionnalité dont nous avons pu profiter après le déblocage était le cache du préprocesseur. Si vous utilisez Babel avec Jest, Jest doit prétraiter chaque fichier JavaScript avant de pouvoir l&#x27;exécuter. Nous avons construit un calque de mise en cache de sorte que chaque fichier, lorsqu&#x27;il n&#x27;est pas modifié, ne doit être transformé qu&#x27;une seule fois. Après avoir libéré Jest, nous avons pu facilement réparer l&#x27;implémentation de l&#x27;open source et l&#x27;expédier sur Facebook. Cela a entraîné une autre victoire de 50% sur la performance. Parce que la cache ne fonctionne que sur la seconde exécution, l&#x27;heure de début froide de Jest n&#x27;a pas été affectée.</p>
<p>Nous avons également réalisé que nous faisions beaucoup d’opérations de trajectoire lorsque nous résolvons des besoins relatifs. Parce que le registre des modules est réinitialisé pour chaque test, il y a eu des milliers d&#x27;appels qui pourraient être mémoisés. Une grande optimisation a été d&#x27;ajouter beaucoup plus de mise en cache, pas seulement autour d&#x27;un seul test, mais aussi à travers les fichiers de test. Auparavant, nous générerions des métadonnées de module pour la fonction d&#x27;automocking une fois pour chaque fichier de test. L&#x27;objet qu&#x27;un module exporte ne change jamais, donc nous partageons maintenant ce code entre les fichiers de test. Malheureusement, comme JavaScript et Node.js n&#x27;ont pas de mémoire partagée, nous devons faire tout ce travail au moins une fois par processus de travail.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="tout-remettre-en-question">Tout remettre en question<a href="#tout-remettre-en-question" class="hash-link" aria-label="Direct link to Tout remettre en question" title="Direct link to Tout remettre en question">​</a></h2>
<p>Lorsque vous essayez d&#x27;améliorer les performances, il est important de plonger aussi dans les systèmes qui s&#x27;installent au-dessus et en dessous de votre système. Dans le cas de Jest, des choses comme Node.js et les fichiers de test eux-mêmes, par exemple. L&#x27;une des premières choses que nous avons faites était de mettre à jour Node.js à Facebook à partir des années 0,10 à iojs et ensuite à Node 4. La nouvelle version de V8 a contribué à améliorer les performances et a été assez facile à mettre à jour.</p>
<p>Nous avons remarqué que le module <code>path</code> dans Node. s est lent lors de la création de milliers d&#x27;opérations de chemin qui ont été <a href="https://github.com/nodejs/node/pull/5123" target="_blank" rel="noopener noreferrer">corrigées dans Node 5.7</a>. Jusqu&#x27;à ce que nous supprimions le support de Node 4 en interne sur Facebook, nous expédierons notre propre version du module <a href="https://github.com/facebook/node-haste/blob/master/src/fastpath.js" target="_blank" rel="noopener noreferrer">fastpath</a>.</p>
<p>Nous avons ensuite commencé à interroger le <a href="https://github.com/facebook/node-haste" target="_blank" rel="noopener noreferrer">node-haste</a> obsolète. Comme mentionné précédemment, le projet entier doit être analysé pour les en-têtes de <code>@providesModule</code> pour construire un graphique de dépendances. Quand ce système a été construit à l&#x27;origine, <code>node_modules</code> n&#x27;existait pas et notre explorateur de système de fichiers ne les excluait pas correctement.</p>
<p>Dans les versions précédentes, Jest lisait en fait tous les fichiers dans <code>node_modules</code> – ce qui a contribué au lente temps de démarrage de Jest. Lorsque nous avons repris Jest, nous avons remplacé l&#x27;ensemble du projet par une nouvelle implémentation, basée sur l&#x27;empaquetage de react-native. Le temps de démarrage de Jest est maintenant inférieur à une seconde, même sur les grands projets. L&#x27;équipe react-native <a href="https://twitter.com/void_0" target="_blank" rel="noopener noreferrer">David</a>, <a href="https://twitter.com/amasad" target="_blank" rel="noopener noreferrer">Amjad</a> et <a href="https://twitter.com/martinbigio" target="_blank" rel="noopener noreferrer">Martin</a> ont fait un travail remarquable sur ce projet.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="tout-additionner">Tout additionner<a href="#tout-additionner" class="hash-link" aria-label="Direct link to Tout additionner" title="Direct link to Tout additionner">​</a></h2>
<p>Un grand nombre des changements ci-dessus ont amélioré le temps d&#x27;exécution du test de 10% ou parfois même de 50%. Nous avons commencé à une durée d&#x27;exécution d&#x27;environ 10 minutes pour tous les tests, et sans ces améliorations, nous serions probablement à environ 20 minutes. Après ces améliorations, cependant, il faut maintenant toujours environ 1 minute et 35 secondes pour exécuter tous nos tests !</p>
<p>Plus important encore, l&#x27;ajout de nouveaux tests entraîne une croissance très lente du temps d&#x27;exécution total. Les ingénieurs peuvent écrire et exécuter plus de tests sans en ressentir les coûts.</p>
<p>With Jest&#x27;s recent 0.9 release and performance improvements from the <a href="https://github.com/jestjs/jest/pull/599" target="_blank" rel="noopener noreferrer">node-haste2 integration</a>, the runtime of the <a href="https://github.com/facebook/relay" target="_blank" rel="noopener noreferrer">Relay</a> framework&#x27;s test suite went down from 60 seconds to about 25 and the <a href="https://github.com/facebook/react-native" target="_blank" rel="noopener noreferrer">react-native</a> test suite now finishes in less than ten seconds on a 13” MacBook Pro.</p>
<p>Nous sommes très heureux des victoires que nous avons vues jusqu&#x27;à présent, et nous allons continuer à travailler sur Jest et à le rendre meilleur. Si vous êtes curieux de contribuer à Jest, n&#x27;hésitez pas à nous contacter sur GitHub, <a href="https://discord.gg/j6FKKQQrW9" target="_blank" rel="noopener noreferrer">Discord</a> ou Facebook :)</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_JgJa"><div class="col margin-top--sm"><a href="https://github.com/jestjs/jest/tree/main/website/blog/2016-03-11-javascript-unit-testing-performance.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Modifier cette page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navigation dans la page d&#x27;article du blog"><a class="pagination-nav__link pagination-nav__link--prev" href="/fr/blog/2016/04/12/jest-11"><div class="pagination-nav__sublabel">Article plus récent</div><div class="pagination-nav__label">Jest 11.0</div></a></nav></main><div class="col col--2"><div class="tableOfContents_XG6w thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#planification-optimale-dune-exécution-de-test" class="table-of-contents__link toc-highlight">Planification optimale d&#39;une exécution de test</a></li><li><a href="#inline-requires-and-lazy-mocking" class="table-of-contents__link toc-highlight">Inline Requires and Lazy Mocking</a></li><li><a href="#repo-sync-et-mise-en-cache" class="table-of-contents__link toc-highlight">Repo-Sync et mise en cache</a></li><li><a href="#tout-remettre-en-question" class="table-of-contents__link toc-highlight">Tout remettre en question</a></li><li><a href="#tout-additionner" class="table-of-contents__link toc-highlight">Tout additionner</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fr/docs/getting-started">Premiers pas</a></li><li class="footer__item"><a class="footer__link-item" href="/fr/docs/snapshot-testing">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/fr/docs/api">Référence de l&#x27;API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Communauté</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/jestjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.reactiflux.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactiflux<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/jestjs_" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Plus</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fr/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/jestjs/jest" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/jestjs_" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Mentions légales</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Confidentialité<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Conditions Générales d&#x27;Utilisation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_tutC"><img src="/fr/img/oss_logo.png" alt="Facebook Open Source Logo" class="footer__logo themedComponent_siVc themedComponent--light_hHel"><img src="/fr/img/oss_logo.png" alt="Facebook Open Source Logo" class="footer__logo themedComponent_siVc themedComponent--dark_yETr"></a></div><div class="footer__copyright">Copyright © 2023 Meta Platforms, Inc. and affiliates. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>