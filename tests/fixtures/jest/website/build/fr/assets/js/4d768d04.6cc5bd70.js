"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[6407],{4147:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var t=n(4246),i=n(1670);const r={title:"Jest 25\xa0: \ud83d\ude80 pose des fondations pour le futur",author:"Simen Bekkhus",authorURL:"https://github.com/SimenB",authorFBID:0x5af3c395182e},o=void 0,a={permalink:"/fr/blog/2020/01/21/jest-25",editUrl:"https://github.com/jestjs/jest/tree/main/website/blog/2020-01-21-jest-25.md",source:"@site/i18n/fr/docusaurus-plugin-content-blog/2020-01-21-jest-25.md",title:"Jest 25\xa0: \ud83d\ude80 pose des fondations pour le futur",description:"Jest 25 pose les bases de nombreux changements majeurs \xe0 l'avenir. Nous avons donc limit\xe9 au maximum les changements de rupture, mais les modifications de l'architecture interne peuvent n\xe9cessiter une attention particuli\xe8re pendant la mise \xe0 niveau. Les principaux changements sont une mise \xe0 niveau de JSDOM de la v11 \xe0 la v15, des tests 10-15% plus rapides, une nouvelle vue diff pour les instantan\xe9s p\xe9rim\xe9s et l'abandon du support de Node 6.",date:"2020-01-21T00:00:00.000Z",formattedDate:"21 janvier 2020",tags:[],readingTime:8.18,hasTruncateMarker:!0,authors:[{name:"Simen Bekkhus",url:"https://github.com/SimenB"}],frontMatter:{title:"Jest 25\xa0: \ud83d\ude80 pose des fondations pour le futur",author:"Simen Bekkhus",authorURL:"https://github.com/SimenB",authorFBID:0x5af3c395182e},unlisted:!1,prevItem:{title:"Jest 26\xa0: Tic Tac",permalink:"/fr/blog/2020/05/05/jest-26"},nextItem:{title:"Jest 24\xa0: \ud83d\udc85 Actualisation, polissage, facilit\xe9 d'utilisation de TypeScript",permalink:"/fr/blog/2019/01/25/jest-24-refreshing-polished-typescript-friendly"}},u={authorsImageUrls:[void 0]},l=[{value:"Au revoir Node 6",id:"au-revoir-node-6",level:2},{value:"Am\xe9liorations des performances",id:"am\xe9liorations-des-performances",level:2},{value:"Couverture de code V8",id:"couverture-de-code-v8",level:2},{value:"Penser vite et lentement quand les tests \xe9chouent",id:"penser-vite-et-lentement-quand-les-tests-\xe9chouent",level:2},{value:"Couleurs des diff\xe9rences lorsque les tests de snapshot \xe9chouent",id:"couleurs-des-diff\xe9rences-lorsque-les-tests-de-snapshot-\xe9chouent",level:2},{value:"Prise en charge des modules ECMAScript",id:"prise-en-charge-des-modules-ecmascript",level:2},{value:"Autres am\xe9liorations et mises \xe0 jour",id:"autres-am\xe9liorations-et-mises-\xe0-jour",level:2},{value:"Plans pour l&#39;avenir",id:"plans-pour-lavenir",level:2}];function d(e){const s=Object.assign({p:"p",a:"a",h2:"h2",code:"code",ul:"ul",li:"li",strong:"strong",ol:"ol",img:"img",em:"em"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Jest 25 pose les bases de nombreux changements majeurs \xe0 l'avenir. Nous avons donc limit\xe9 au maximum les changements de rupture, mais les modifications de l'architecture interne peuvent n\xe9cessiter une attention particuli\xe8re pendant la mise \xe0 niveau. Les principaux changements sont une mise \xe0 niveau de JSDOM de la v11 \xe0 la v15, des tests 10-15% plus rapides, une nouvelle vue diff pour les instantan\xe9s p\xe9rim\xe9s et l'abandon du support de Node 6."}),"\n",(0,t.jsxs)(s.p,{children:["There has been more than 200 commits since Jest 24.9 by more than 80 different contributors, so as always, take a look at the ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/CHANGELOG.md",children:"changelog"})," for a full list of changes."]}),"\n",(0,t.jsx)(s.h2,{id:"au-revoir-node-6",children:"Au revoir Node 6"}),"\n",(0,t.jsxs)(s.p,{children:["Node 6 est en fin de vie depuis le 30 avril 2019, et Jest 25 le laisse derri\xe8re lui. L'abandon de Node 6 signifie que nous pouvons mettre \xe0 jour nos d\xe9pendances, la principale \xe9tant JSDOM, qui a \xe9t\xe9 mise \xe0 jour \xe0 la version 15. La mise \xe0 niveau signifie \xe9galement que nous ne devons plus transpiler la syntaxe ",(0,t.jsx)(s.code,{children:"async-await"}),", ce qui se traduit \xe0 la fois par une ex\xe9cution plus rapide du code et une moindre consommation de m\xe9moire. En prime, le code transpil\xe9 de Jest devrait \xeatre plus facile \xe0 d\xe9boguer si quelqu'un se retrouve \xe0 d\xe9valer cette pente."]}),"\n",(0,t.jsxs)(s.p,{children:["M\xeame si Node 8 est \xe9galement entr\xe9 en fin de vie, Jest 25 continuera \xe0 le prendre en charge afin de rendre la mise \xe0 niveau aussi facile que possible pour ceux d'entre nous qui prennent encore en charge Node 8. Elle s'accompagne cependant de quelques compromis, comme le fait que JSDOM v16 a \xe9t\xe9 publi\xe9 sans le support de Node 8, vous devrez donc utiliser ",(0,t.jsx)(s.a,{href:"https://www.npmjs.com/package/jest-environment-jsdom-sixteen",children:(0,t.jsx)(s.code,{children:"jest-environment-jsdom-sixteen"})})," si vous voulez utiliser la derni\xe8re version."]}),"\n",(0,t.jsx)(s.h2,{id:"am\xe9liorations-des-performances",children:"Am\xe9liorations des performances"}),"\n",(0,t.jsx)(s.p,{children:"Nous avons re\xe7u des rapports indiquant que Jest a ralenti au cours des deux derni\xe8res versions. Jest 25 comprend une mise \xe0 jour de Micromatch, qui apporte des gains \xe9normes en temps de d\xe9marrage, et quelques corrections de bogues et ajustements de performance qui ram\xe8ne Jest \xe0 la vitesse \xe0 laquelle il \xe9tait pour Jest 23. Pour Jest lui-m\xeame, comme mentionn\xe9 au d\xe9but de cet article, cela signifie une r\xe9duction de 10-15% du temps d'ex\xe9cution des tests. Bien entendu, nous cherchons toujours \xe0 nous am\xe9liorer, alors n'h\xe9sitez pas \xe0 comparer les r\xe9sultats avec ceux des versions pr\xe9c\xe9dentes et \xe0 signaler les probl\xe8mes qui pourraient survenir\xa0!"}),"\n",(0,t.jsx)(s.h2,{id:"couverture-de-code-v8",children:"Couverture de code V8"}),"\n",(0,t.jsxs)(s.p,{children:["L'instrumentation de couverture de code actuelle de Jest est aliment\xe9e par ",(0,t.jsx)(s.code,{children:"babel-plugin-istanbul"})," qui ins\xe8re du code de collecte de couverture de code avant de cr\xe9er des rapports. Cependant, cette m\xe9thode est assez lente et gourmande en m\xe9moire, surtout pour les fichiers et les bases de code volumineux. Heureusement, V8 a une couverture de code int\xe9gr\xe9e, qui devient de plus en plus utilisable dans Node gr\xe2ce au travail acharn\xe9 de ",(0,t.jsx)(s.a,{href:"https://github.com/bcoe",children:"Benjamin Coe"})," et d'autres membres des \xe9quipes V8 et Node.js. Jest 25 est livr\xe9 avec un support exp\xe9rimental pour cela via un nouveau drapeau ",(0,t.jsx)(s.code,{children:"--coverage-provider"}),". Veuillez consulter sa ",(0,t.jsx)(s.a,{href:"/docs/configuration#coverageprovider-string",children:"documentation"})," pour les avertissements et la fa\xe7on de l'utiliser."]}),"\n",(0,t.jsx)(s.h2,{id:"penser-vite-et-lentement-quand-les-tests-\xe9chouent",children:"Penser vite et lentement quand les tests \xe9chouent"}),"\n",(0,t.jsx)(s.p,{children:"Les efforts inutiles pour interpr\xe9ter les rapports en cas d'\xe9chec des tests sont un frein\xa0:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\xab\xa0penser rapidement\xa0\xbb pour reconna\xeetre les mod\xe8les de votre exp\xe9rience pass\xe9e"}),"\n",(0,t.jsx)(s.li,{children:"\xab\xa0penser lentement\xa0\xbb pour analyser les changements et d\xe9cider s'il s'agit de progr\xe8s attendus ou de r\xe9gressions inattendues"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Jest 25 ach\xe8ve la seconde moiti\xe9 d'un effort commenc\xe9 en Jest 24 pour am\xe9liorer tous les comparateurs\xa0:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["une ligne de description correcte, y compris les modificateurs ",(0,t.jsx)(s.code,{children:".rejects"}),", ",(0,t.jsx)(s.code,{children:".resolves"})," et ",(0,t.jsx)(s.code,{children:".not"})]}),"\n",(0,t.jsx)(s.li,{children:"des libell\xe9s concis et un alignement uniforme pour les valeurs attendues et re\xe7ues"}),"\n",(0,t.jsx)(s.li,{children:"inverse la mise en \xe9vidence des diff\xe9rences de sous-cha\xeenes lorsque attendu et re\xe7u sont des cha\xeenes de caract\xe8res"}),"\n",(0,t.jsx)(s.li,{children:"nombre de lignes modifi\xe9es dans les diff\xe9rences pour savoir si c'est seulement des suppressions ou des insertions"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Nous remercions tout particuli\xe8rement le mainteneur de Jest ",(0,t.jsx)(s.a,{href:"https://github.com/pedrottimark",children:"Mark Pedrotti"})," pour avoir pilot\xe9 cet effort et son travail continu pour rendre les erreurs d'expectation aussi satisfaisantes que possible."]}),"\n",(0,t.jsx)(s.h2,{id:"couleurs-des-diff\xe9rences-lorsque-les-tests-de-snapshot-\xe9chouent",children:"Couleurs des diff\xe9rences lorsque les tests de snapshot \xe9chouent"}),"\n",(0,t.jsx)(s.p,{children:"Le changement le plus \xe9vident pour remplacer la confusion par la confiance est la couleur des lignes de changement dans les diff\xe9rences lorsque les tests snapshot \xe9chouent\xa0:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"- Snapshot"})," passe du vert au ",(0,t.jsx)(s.strong,{children:"magenta"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"+ Received"})," passe du rouge au ",(0,t.jsx)(s.strong,{children:"bleu sarcelle"})," sur fond cyan/aqua"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Exemples de rapports de tests (avant \xe0 gauche et apr\xe8s \xe0 droite)"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Le nombre de lignes modifi\xe9es confirme votre premi\xe8re impression\xa0: dans quel sens le snapshot a-t-il chang\xe9 (c'est-\xe0-dire, lignes supprim\xe9es ou ins\xe9r\xe9es)"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"snapshot-insert-lines",src:n(4807).Z+"",width:"1800",height:"532"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Les couleurs de fond attirent vos yeux pour comparer les lignes modifi\xe9es adjacentes"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"snapshot-change-lines",src:n(7912).Z+"",width:"1800",height:"504"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["Les couleurs de fond vous aident \xe9galement \xe0 voir quels tests ",(0,t.jsx)(s.code,{children:"toThrow"})," n\xe9cessitent une d\xe9cision sur la mise \xe0 jour ou non du snapshot"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"snapshot-change-substrings",src:n(1668).Z+"",width:"1800",height:"168"})}),"\n",(0,t.jsx)(s.p,{children:"Voici quelques raisons pour lesquelles nous avons choisi des couleurs uniques\xa0:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Pour 95 % des personnes qui ont une vision compl\xe8te des couleurs, elles peuvent reconna\xeetre rapidement les rapports provenant de tests snapshot par rapport \xe0 tous les autres comparateurs."}),"\n",(0,t.jsx)(s.li,{children:"Cela r\xe9sout le conflit direct entre la signification du vert/rouge dans les tests Jest et le rouge/vert dans la r\xe9vision du code."}),"\n",(0,t.jsx)(s.li,{children:"Contrairement \xe0 l'inversion rouge/vert qui sugg\xe8re que la mise \xe0 jour est la d\xe9cision par d\xe9faut, ceci sugg\xe8re que les diff\xe9rences n\xe9cessitent un examen plus attentif pour une \xe9ventuelle r\xe9gression dans les \xe9checs des tests snapshot locaux que dans la r\xe9vision du code (lorsque les probl\xe8mes ont d\xe9j\xe0 \xe9t\xe9 corrig\xe9s)."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"La diff\xe9rence de teinte entre le magenta \xe0 300\xb0 et le sarcelle/cyan/aqua \xe0 180\xb0 donne une meilleure accessibilit\xe9 \xe0 la vision des couleurs et la teinte de fond claire pour les lignes modifi\xe9es donne un contraste coh\xe9rent sur les th\xe8mes clairs et fonc\xe9s."}),"\n",(0,t.jsxs)(s.p,{children:["If you maintain a command line tool, you might find inspiration to improve its accessibility in ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/9132",children:"#9132"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"prise-en-charge-des-modules-ecmascript",children:"Prise en charge des modules ECMAScript"}),"\n",(0,t.jsxs)(s.p,{children:["Node 13 a un support ESM non signal\xe9, et nous avons commenc\xe9 \xe0 travailler un tout petit peu vers un support natif dans Jest. Jest 25 inclut le support pour les fichiers de configuration ",(0,t.jsx)(s.code,{children:"jest.config.cjs"})," et ",(0,t.jsx)(s.code,{children:"jest.config.mjs"}),", mais les tests eux-m\xeames ne peuvent pas encore \xeatre \xe9crits en utilisant l'ESM sans quelque chose comme Babel ou TypeScript qui le transforme en CJS."]}),"\n",(0,t.jsxs)(s.p,{children:["Les API que Jest utilisera sont encore marqu\xe9es et exp\xe9rimentales, donc ne vous attendez pas \xe0 un support imm\xe9diat. ",(0,t.jsx)(s.a,{href:"https://github.com/nodejs/modules",children:"L'\xe9quipe des modules Node.js"})," travaille activement sur ces API, et nous garderons un \u0153il sur l'\xe9volution de la situation et nous les exp\xe9rimenterons afin de pouvoir fournir des retours. You can subscribe to ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/9430",children:"this issue"})," to get any updates about the implementation status in Jest."]}),"\n",(0,t.jsx)(s.h2,{id:"autres-am\xe9liorations-et-mises-\xe0-jour",children:"Autres am\xe9liorations et mises \xe0 jour"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Jest has passed ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/graphs/contributors",children:"1000 unique contributors"}),". C'est une \xe9tape incroyable\xa0! Merci \xe0 tous ceux qui nous aident \xe0 rendre les tests aussi agr\xe9ables que possible."]}),"\n",(0,t.jsxs)(s.li,{children:["Gr\xe2ce au membre de la communaut\xe9 ",(0,t.jsx)(s.a,{href:"https://github.com/JoshRosenstein",children:"Josh Rosenstein"}),", Jest prend d\xe9sormais en charge le ",(0,t.jsx)(s.code,{children:"BigInt"})," dans la plupart des comparateurs, tels que ",(0,t.jsx)(s.code,{children:"toBeGreaterThan"}),". Jest comprend \xe9galement les litt\xe9raux bigint imm\xe9diatement."]}),"\n",(0,t.jsxs)(s.li,{children:["La fonctionnalit\xe9 de Jest ",(0,t.jsx)(s.code,{children:"--detect-leaks"})," a \xe9t\xe9 d\xe9faillante pour Node 12 et plus r\xe9cent - ceci a \xe9t\xe9 corrig\xe9 dans Jest 25."]}),"\n",(0,t.jsxs)(s.li,{children:["Comme annonc\xe9 dans l'article du blog de Jest 24, la base de code de Jest a \xe9t\xe9 r\xe9\xe9crite en TypeScript - ce travail a \xe9t\xe9 achev\xe9 dans Jest 24.3. Ainsi, si vous utilisez l'une des parties individuelles de Jest, vous devriez b\xe9n\xe9ficier d'une excellente int\xe9gration avec l'IDE. Pour l'avenir, nous voulons vraiment faire en sorte que les simulations de Jest jouent mieux avec les syst\xe8mes de type, et nous aimerions que la communaut\xe9 nous aide \xe0 cet \xe9gard. Please chime in ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/7832",children:"here"})," with ideas and send PRs! Nous allons \xe9galement \xe9tudier le d\xe9placement des typages pour l'utilisation de Jest en tant qu'ex\xe9cuteur de tests de DefinitelyTyped vers Jest lui-m\xeame."]}),"\n",(0,t.jsxs)(s.li,{children:["Le paquet ",(0,t.jsx)(s.code,{children:"jest-diff"})," exporte maintenant des fonctions comme ",(0,t.jsx)(s.code,{children:"diffLinesUnified"})," et ",(0,t.jsx)(s.code,{children:"diffStringsUnified"})," qui ont des options de configuration, afin que d'autres applications puissent formater les diff\xe9rences d'une mani\xe8re personnalis\xe9e. Pour plus d'informations et d'exemples de code, consultez son nouveau fichier ",(0,t.jsx)(s.code,{children:"README.md"})," dans le d\xe9p\xf4t de Jest ou sur les d\xe9p\xf4ts de paquets."]}),"\n",(0,t.jsxs)(s.li,{children:["Gr\xe2ce \xe0 un membre de la communaut\xe9 ",(0,t.jsx)(s.a,{href:"https://github.com/WeiAnAn",children:"Wei An Yen"}),", Jest ne mettra plus en \xe9vidence les comparateurs asym\xe9triques passants dans les erreurs d'expectation. Il s'agit d'un probl\xe8me de longue date avec les comparateurs asym\xe9triques et nous sommes tr\xe8s heureux qu'il soit enfin r\xe9solu."]}),"\n",(0,t.jsxs)(s.li,{children:["Pour la deuxi\xe8me ann\xe9e cons\xe9cutive, Jest a remport\xe9 le plus haut prix de satisfaction de ",(0,t.jsx)(s.a,{href:"https://2019.stateofjs.com/awards/",children:"State of JS"}),". Nous sommes incroyablement reconnaissants pour le soutien de la communaut\xe9 et esp\xe9rons que nous pourrons tirer parti de cet \xe9lan pour rendre 2020 encore meilleure\xa0!"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"plans-pour-lavenir",children:"Plans pour l'avenir"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["La configuration de Jest est vaste et quelque peu maladroite - il y a souvent ",(0,t.jsx)(s.em,{children:"au moins"})," deux fa\xe7ons de faire la m\xeame chose, souvent m\xeame plus. Pour Jest 26, nous esp\xe9rons condenser la configuration et la rendre plus pr\xe9visible. See this ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/7185",children:"issue"})," for details."]}),"\n",(0,t.jsxs)(s.li,{children:["Nous esp\xe9rons \xe9galement \xeatre en mesure de fournir une API programmatique appropri\xe9e pour l'ex\xe9cution de Jest, afin de faciliter l'int\xe9gration dans les IDE et autres outils. Please see ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/5048",children:"this"})," tracking issue."]}),"\n",(0,t.jsxs)(s.li,{children:["Il y a eu un PR ouvert pour l'ajout de Lolex comme impl\xe9mentation des temporisateurs fictifs de Jest depuis d\xe9cembre 2017. Bien que nous ne l'ajoutons pas \xe0 une API publique dans Jest 25, son support est techniquement inclus et nous cherchons comment l'exposer pour que les gens puissent le tester et l'exp\xe9rimenter. L'utiliser signifie que vous pouvez simuler la date et d'autres fonctions de temporisation que Jest ne prend pas en compte actuellement. Notez que cela doit \xeatre consid\xe9r\xe9 comme exp\xe9rimental, et un support API appropri\xe9 viendra dans une version ult\xe9rieure. Follow ",(0,t.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/7776",children:"this PR"})," for the latest updates on the status."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Happy Jesting\xa0! \ud83c\udccf"})]})}const c=function(e={}){const{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,t.jsx)(s,Object.assign({},e,{children:(0,t.jsx)(d,e)})):d(e)}},7912:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/25-snapshot-change-lines-d42906add66e08bb7c0ffffbca9a44bc.png"},1668:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/25-snapshot-change-substrings-0798d37f2f603ec43b57145cddc1247b.png"},4807:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/25-snapshot-insert-lines-8168b88f07172d72e4d2cd0e05d200f1.png"},1670:(e,s,n)=>{n.d(s,{Zo:()=>a,ah:()=>r});var t=n(7378);const i=t.createContext({});function r(e){const s=t.useContext(i);return t.useMemo((()=>"function"==typeof e?e(s):{...s,...e}),[s,e])}const o={};function a({components:e,children:s,disableParentContext:n}){let a;return a=n?"function"==typeof e?e({}):e||o:r(e),t.createElement(i.Provider,{value:a},s)}}}]);