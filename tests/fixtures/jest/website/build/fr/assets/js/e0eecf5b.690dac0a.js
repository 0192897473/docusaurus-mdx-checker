"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[6105],{5156:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=t(4246),r=t(1670);const i={title:"Jest 27\xa0: nouvelles valeurs par d\xe9faut pour Jest, \xe9dition 2021 \u23e9",author:"Tim Seckinger",authorURL:"https://github.com/jeysal",authorImageURL:"https://avatars.githubusercontent.com/u/16069751"},o=void 0,a={permalink:"/fr/blog/2021/05/25/jest-27",editUrl:"https://github.com/jestjs/jest/tree/main/website/blog/2021-05-25-jest-27.md",source:"@site/i18n/fr/docusaurus-plugin-content-blog/2021-05-25-jest-27.md",title:"Jest 27\xa0: nouvelles valeurs par d\xe9faut pour Jest, \xe9dition 2021 \u23e9",description:"Dans l'article du blog pour Jest 26, il y a environ un an, nous avons annonc\xe9 qu'apr\xe8s deux versions majeures avec peu de modifications de rupture, Jest 27 basculera quelques interrupteurs afin de d\xe9finir de meilleures valeurs par d\xe9faut pour les projets qui sont nouveaux ou qui peuvent migrer en douceur. Cela nous donne l'opportunit\xe9 de retirer certains paquets de la distribution par d\xe9faut de Jest 28 et de les publier en tant que modules installables et connectables s\xe9par\xe9ment. Tous ceux qui utilisent les nouvelles valeurs par d\xe9faut peuvent b\xe9n\xe9ficier d'une installation plus petite, tandis que ceux qui ont besoin de ces paquets peuvent toujours les installer s\xe9par\xe9ment.",date:"2021-05-25T00:00:00.000Z",formattedDate:"25 mai 2021",tags:[],readingTime:7.33,hasTruncateMarker:!0,authors:[{name:"Tim Seckinger",url:"https://github.com/jeysal",imageURL:"https://avatars.githubusercontent.com/u/16069751"}],frontMatter:{title:"Jest 27\xa0: nouvelles valeurs par d\xe9faut pour Jest, \xe9dition 2021 \u23e9",author:"Tim Seckinger",authorURL:"https://github.com/jeysal",authorImageURL:"https://avatars.githubusercontent.com/u/16069751"},unlisted:!1,prevItem:{title:"Jest 28\xa0: Perte de poids et compatibilit\xe9 accrue \ud83e\udef6",permalink:"/fr/blog/2022/04/25/jest-28"},nextItem:{title:"Mise \xe0 niveau du site web de Jest",permalink:"/fr/blog/2021/03/09/jest-website-upgrade"}},u={authorsImageUrls:[void 0]},l=[{value:"Mises \xe0 jour des fonctionnalit\xe9s",id:"mises-\xe0-jour-des-fonctionnalit\xe9s",level:2},{value:"Inversion des valeurs par d\xe9faut",id:"inversion-des-valeurs-par-d\xe9faut",level:2},{value:"Fonctionnalit\xe9s \xe0 venir avec des changements de rupture",id:"fonctionnalit\xe9s-\xe0-venir-avec-des-changements-de-rupture",level:2},{value:"Divers changements de rupture",id:"divers-changements-de-rupture",level:2}];function d(e){const s=Object.assign({p:"p",a:"a",h2:"h2",strong:"strong",img:"img",br:"br",code:"code",ul:"ul",li:"li",em:"em"},(0,r.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:["Dans l'",(0,n.jsx)(s.a,{href:"/blog/2020/05/05/jest-26",children:"article du blog pour Jest 26"}),", il y a environ un an, nous avons annonc\xe9 qu'apr\xe8s deux versions majeures avec peu de modifications de rupture, Jest 27 basculera quelques interrupteurs afin de d\xe9finir de meilleures valeurs par d\xe9faut pour les projets qui sont nouveaux ou qui peuvent migrer en douceur. Cela nous donne l'opportunit\xe9 de retirer certains paquets de la distribution par d\xe9faut de Jest 28 et de les publier en tant que modules installables et connectables s\xe9par\xe9ment. Tous ceux qui utilisent les nouvelles valeurs par d\xe9faut peuvent b\xe9n\xe9ficier d'une installation plus petite, tandis que ceux qui ont besoin de ces paquets peuvent toujours les installer s\xe9par\xe9ment."]}),"\n",(0,n.jsxs)(s.p,{children:["Avec le premier changement majeur des valeurs par d\xe9faut depuis les ",(0,n.jsx)(s.a,{href:"/blog/2016/09/01/jest-15",children:"nouvelles valeurs par d\xe9faut pour Jest"})," qui accompagnaient la version 15, Jest 27 est maintenant l\xe0, pour que Jest reste rapide, l\xe9ger et pertinent dans le futur. Nous expliquerons ces changements de valeurs par d\xe9faut et d'autres changements notables dans cet article, mais tout d'abord, nous allons aborder les nouvelles fonctionnalit\xe9s\xa0!"]}),"\n",(0,n.jsx)(s.h2,{id:"mises-\xe0-jour-des-fonctionnalit\xe9s",children:"Mises \xe0 jour des fonctionnalit\xe9s"}),"\n",(0,n.jsxs)(s.p,{children:["Tout d'abord, le mode interactif que vous connaissez peut-\xeatre pour examiner et mettre \xe0 jour les snapshots en erreur peut d\xe9sormais \xeatre utilis\xe9 pour ",(0,n.jsx)(s.strong,{children:"passer les tests en erreur"})," un par un. Credit goes to first-time contributor ",(0,n.jsx)(s.a,{href:"https://github.com/NullDivision",children:"@NullDivision"})," for ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/10858",children:"implementing"})," this feature!"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"\xc9chec d&#39;un test interactif",src:t(1021).Z+"",width:"2416",height:"1289"})}),"\n",(0,n.jsxs)(s.p,{children:["Speaking of snapshots, one of the more exciting features we've shipped in recent years are Inline Snapshots, which ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/6380",children:"landed"})," in a minor release of Jest 23 almost three years ago. However, they came with the restriction that projects wanting to utilize them must be using ",(0,n.jsx)(s.a,{href:"https://prettier.io/",children:"Prettier"})," to format their code, because that's what Jest would use to make sure the file it writes the snapshots into remains properly formatted.",(0,n.jsx)(s.br,{}),"\n","And so for most of these years, we've had a ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/7792",children:"pull request"})," in the pipeline to eliminate this restriction and allow using ",(0,n.jsx)(s.strong,{children:"Inline Snapshots without Prettier"}),". Elle a accumul\xe9 plus d'une centaine de commentaires, sans m\xeame consid\xe9rer les PR qui s'en sont d\xe9tach\xe9es et ont atterri en premier, et elle a m\xeame chang\xe9 de propri\xe9taire une fois apr\xe8s la soumission initiale par un autre premier contributeur, ",(0,n.jsx)(s.a,{href:"https://github.com/mmkal",children:"@mmkal"})," sous le titre de travail hilarant \xab\xa0Uglier Inline Snapshots\xa0\xbb (\xab\xa0Snapshots en ligne hideux\xa0\xbb). Avec l'ascension fulgurante de Prettier ces derniers temps, cette am\xe9lioration est maintenant peut-\xeatre moins n\xe9cessaire qu'en 2018, mais tout de m\xeame, nous connaissons ce sentiment de se retrouver dans un projet qui n'utilise pas Prettier, et de ne plus pouvoir soudainement utiliser les snapshots en ligne. Plus jamais \xe7a\xa0!"]}),"\n",(0,n.jsxs)(s.p,{children:["La raison principale pour laquelle il nous a fallu tant de temps pour r\xe9aliser ce projet \xe9tait, de mani\xe8re assez surprenante, une erreur de m\xe9moire dans notre pipeline de construction. It turns out that the dependencies we load for each test file to perform the parsing, snapshot insertion, and printing do incur a significant time and memory overhead.",(0,n.jsx)(s.br,{}),"\n","So with some ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/9898",children:"tricks"}),", we've ",(0,n.jsx)(s.strong,{children:"speed up the initialization per test file"})," by roughly 70% compared to Jest 26. Notez que vous ne verrez certainement pas une telle am\xe9lioration des performances sur votre projet - vous auriez besoin de beaucoup de fichiers de test qui s'ex\xe9cutent chacun tr\xe8s rapidement pour mieux le remarquer, et la surcharge lors de l'utilisation d'un ",(0,n.jsx)(s.a,{href:"/docs/configuration#testenvironment-string",children:"environnement JSDOM"})," \xe9clipse une telle am\xe9lioration."]}),"\n",(0,n.jsxs)(s.p,{children:["In other news, the ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/9430",children:"native ESM support"})," is progressing, but some major complexities, for instance around mocking, are still ahead of us, and we continue to observe the migration to ESM as a huge ecosystem effort, where Node and a lot of crucial tools and packages all have to rely on each other to deliver an overall compelling experience.",(0,n.jsx)(s.br,{}),"\n","ESM support ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/11167",children:"for plugging modules into Jest"})," is more advanced\u2014custom runners, reporters, watch plugins, and many other modules can already be loaded as ES modules."]}),"\n",(0,n.jsxs)(s.p,{children:["We've also merged ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/9351",children:"a PR"})," to be able to deal with test files symlinked into the test directory, a feature much wanted by users of ",(0,n.jsx)(s.a,{href:"https://bazel.build/",children:"Bazel"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/issues/9504",children:"Another PR"})," enabled ",(0,n.jsxs)(s.a,{href:"/docs/configuration#transform-objectstring-pathtotransformer--pathtotransformer-object",children:[(0,n.jsx)(s.code,{children:"transform"}),"s"]})," to be asynchronous, a requirement to support transpilation through tools such as ",(0,n.jsx)(s.a,{href:"https://esbuild.github.io/",children:"esbuild"}),", ",(0,n.jsx)(s.a,{href:"https://www.snowpack.dev/",children:"Snowpack"}),", and ",(0,n.jsx)(s.a,{href:"https://vitejs.dev/",children:"Vite"})," effectively."]}),"\n",(0,n.jsx)(s.h2,{id:"inversion-des-valeurs-par-d\xe9faut",children:"Inversion des valeurs par d\xe9faut"}),"\n",(0,n.jsxs)(s.p,{children:["Jusqu'\xe0 pr\xe9sent, si vous utilisiez Jest dans sa configuration par d\xe9faut, vous ex\xe9cutiez - peut-\xeatre sans le savoir - un code fork\xe9 il y a plusieurs ann\xe9es \xe0 partir de l'ex\xe9cuteur de tests ",(0,n.jsx)(s.a,{href:"https://jasmine.github.io/2.0/introduction",children:"Jasmine 2.0"})," qui fournit des fonctions de framework de test telles que ",(0,n.jsx)(s.code,{children:"describe"}),", ",(0,n.jsx)(s.code,{children:"it"}),", et ",(0,n.jsx)(s.code,{children:"beforeEach"}),". In 2017, ",(0,n.jsx)(s.a,{href:"https://github.com/aaronabramov",children:"Aaron Abramov"})," ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/3668",children:"initially wrote"})," a ",(0,n.jsx)(s.strong,{children:"replacement for the Jasmine code"})," called ",(0,n.jsx)(s.code,{children:"jest-circus"}),", meant to improve error messages, maintainability, and extensibility.",(0,n.jsx)(s.br,{}),"\n","After years of large-scale use at Facebook and of course in Jest itself, as well as recent adoption in ",(0,n.jsx)(s.code,{children:"create-react-app"}),", we are now confident that ",(0,n.jsx)(s.code,{children:"jest-circus"})," is highly compatible with ",(0,n.jsx)(s.code,{children:"jest-jasmine2"})," and should work in most environments with little to no migration work. Il peut y avoir des diff\xe9rences mineures dans l'ordre d'ex\xe9cution et la rigueur, mais nous ne pr\xe9voyons pas de difficult\xe9s majeures de mise \xe0 niveau autres que pour le code s'appuyant sur des API sp\xe9cifiques \xe0 Jasmine telles que ",(0,n.jsx)(s.code,{children:"jasmine.getEnv()"}),". Si vous vous appuyez largement sur de telles API, vous pouvez opter \xe0 nouveau pour le gestionnaire de tests bas\xe9 sur Jasmine en ",(0,n.jsx)(s.a,{href:"/docs/configuration#testrunner-string",children:"configurant"})," ",(0,n.jsx)(s.code,{children:'"testRunner" : "jest-jasmine2"'}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["L'ex\xe9cution de tests dans un ",(0,n.jsx)(s.a,{href:"/docs/configuration#testenvironment-string",children:"environnement JSDOM"})," entra\xeene un surco\xfbt de performance non n\xe9gligeable. Parce que c'\xe9tait le comportement par d\xe9faut de Jest, sauf configuration contraire jusque-l\xe0, les utilisateurs qui \xe9crivent des applications Node, par exemple, peuvent ne m\xeame pas savoir qu'ils re\xe7oivent un environnement DOM co\xfbteux dont ils n'ont m\xeame pas besoin.",(0,n.jsx)(s.br,{}),"\n","Pour cette raison, nous allons ",(0,n.jsx)(s.strong,{children:"changer l'environnement de test par d\xe9faut"})," de ",(0,n.jsx)(s.code,{children:'"jsdom"'})," \xe0 ",(0,n.jsx)(s.code,{children:'"node"'}),". Si vous \xeates affect\xe9 par ce changement parce que vous utilisez les API DOM et que l'environnement de test n'est pas explicitement configur\xe9, vous devriez recevoir une erreur lorsque par exemple ",(0,n.jsx)(s.code,{children:"document"})," est acc\xe9d\xe9, et vous pouvez configurer ",(0,n.jsx)(s.code,{children:'"testEnvironment" : "jsdom"'})," ou utiliser ",(0,n.jsx)(s.a,{href:"/docs/configuration#testenvironment-string",children:"la configuration de l'environnement par fichier"})," pour r\xe9soudre ce probl\xe8me.",(0,n.jsx)(s.br,{}),"\n","Pour les projets mixtes o\xf9 certains tests n\xe9cessitent un environnement DOM mais d'autres non, nous recommandons d'utiliser l'environnement rapide ",(0,n.jsx)(s.code,{children:'"node"'})," par d\xe9faut et de d\xe9clarer exactement les tests qui ont besoin du DOM en utilisant des ",(0,n.jsx)(s.a,{href:"/docs/configuration#testenvironment-string",children:"docblocks"}),".",(0,n.jsx)(s.br,{}),"\n","Dans la prochaine version majeure, nous pr\xe9voyons \xe9galement d'\xe9liminer ",(0,n.jsx)(s.code,{children:"jest-jasmine2"})," et ",(0,n.jsx)(s.code,{children:"jest-environment-jsdom"})," de l'arbre de d\xe9pendances de Jest et d'exiger qu'ils soient install\xe9s explicitement, afin que de nombreux utilisateurs puissent profiter d'une taille d'installation plus petite avec moins de superflu."]}),"\n",(0,n.jsxs)(s.p,{children:["Une autre valeur par d\xe9faut que nous changeons affecte les faux temporisateurs alias les ",(0,n.jsx)(s.a,{href:"/docs/timer-mocks",children:"simulateurs de temporisation"}),". Nous avons introduit une option d'impl\xe9mentation \xab\xa0moderne\xa0\xbb de faux temporisateurs dans Jest 26 accessible de mani\xe8re transparente via la m\xeame API, mais avec une simulation beaucoup plus compl\xe8te, notamment pour ",(0,n.jsx)(s.code,{children:"Date"})," et ",(0,n.jsx)(s.code,{children:"queueMicrotask"}),".",(0,n.jsx)(s.br,{}),"\n",". Cette ",(0,n.jsx)(s.strong,{children:"impl\xe9mentation moderne de faux temporisateurs sera d\xe9sormais la valeur par d\xe9faut"}),". Si vous faites partie des quelques malchanceux qui sont trop lourdement affect\xe9s par les subtiles diff\xe9rences d'impl\xe9mentation pour migrer, vous pouvez r\xe9cup\xe9rer l'ancienne impl\xe9mentation en utilisant ",(0,n.jsx)(s.code,{children:'jest.useFakeTimers("legacy")'})," ou, si vous activez les faux temporisateurs globalement via ",(0,n.jsx)(s.a,{href:"/docs/configuration#timers-string",children:"configuration"}),", ",(0,n.jsx)(s.code,{children:'"timers" : "legacy"'}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"fonctionnalit\xe9s-\xe0-venir-avec-des-changements-de-rupture",children:"Fonctionnalit\xe9s \xe0 venir avec des changements de rupture"}),"\n",(0,n.jsx)(s.p,{children:"Nous avons introduit quelques petits changements de rupture suppl\xe9mentaires pour vous aider \xe0 \xe9viter les erreurs en interdisant certaines choses qui peuvent facilement se produire involontairement\xa0:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Le m\xeame callback de test ",(0,n.jsx)(s.code,{children:"done"})," ne peut \xeatre appel\xe9 plus d'une fois,"]}),"\n",(0,n.jsxs)(s.li,{children:["l'appel \xe0 ",(0,n.jsx)(s.code,{children:"done"})," et le retour d'une promesse ne peuvent pas \xeatre combin\xe9s,"]}),"\n",(0,n.jsxs)(s.li,{children:["un bloc ",(0,n.jsx)(s.code,{children:"describe"})," ne doit rien retourner,"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["and we ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/pull/10512",children:"made some TypeScript types stricter"}),"."]}),"\n",(0,n.jsx)(s.p,{children:"Les modules utilis\xe9s dans les options de configuration suivantes sont d\xe9sormais transform\xe9s comme le reste de votre code, ce qui peut \xeatre une rupture si vous comptez sur leur chargement tel quel\xa0:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"testEnvironment"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"runner"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"testRunner"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"snapshotResolver"})}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"divers-changements-de-rupture",children:"Divers changements de rupture"}),"\n",(0,n.jsx)(s.p,{children:"Nous avons supprim\xe9 certaines fonctions, obsol\xe8tes depuis longtemps\xa0:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"jest.addMatchers"})," (utilisez ",(0,n.jsx)(s.code,{children:"expect.extend"})," \xe0 la place)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"jest.resetModuleRegistry"})," (utilisez ",(0,n.jsx)(s.code,{children:"jest.resetModules"})," \xe0 la place)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"jest.runTimersToTime"})," (utilisez ",(0,n.jsx)(s.code,{children:"jest.advanceTimersByTime"})," \xe0 la place)"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Beaucoup de paquets de Jest ont \xe9t\xe9 migr\xe9s pour utiliser des exportations de style ESM (bien qu'ils soient toujours livr\xe9s en tant que CommonJS), donc si vous consommez par exemple ",(0,n.jsx)(s.code,{children:"pretty-format"})," directement, vous devrez peut-\xeatre ajuster votre import en un import ",(0,n.jsx)(s.code,{children:"default"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Nous avons abandonn\xe9 la prise en charge de Node 13, mais Jest prend toujours en charge les versions ",(0,n.jsx)(s.em,{children:"Current"})," et toutes les versions ",(0,n.jsx)(s.em,{children:"LTS"})," de ",(0,n.jsx)(s.a,{href:"https://nodejs.org/en/about/releases/",children:"Node"})," et Jest 27 continue de prendre en charge Node 10, qui est tomb\xe9 en d\xe9su\xe9tude que r\xe9cemment."]}),"\n",(0,n.jsxs)(s.p,{children:["As always, the full changelog and list of breaking changes can be ",(0,n.jsx)(s.a,{href:"https://github.com/jestjs/jest/blob/main/CHANGELOG.md#2700",children:"viewed here"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Enfin, nous tenons \xe0 remercier la communaut\xe9 qui, une fois de plus, a accord\xe9 \xe0 Jest un taux de satisfaction exceptionnel de 96 % dans l'enqu\xeate ",(0,n.jsx)(s.a,{href:"https://2020.stateofjs.com/en-US/technologies/testing/",children:"State of JS 2020"}),"\xa0! Soyez prudents, et nous esp\xe9rons que vous continuerez \xe0 utiliser Jest avec plaisir dans les ann\xe9es et versions \xe0 venir\xa0! \ud83c\udccf"]})]})}const c=function(e={}){const{wrapper:s}=Object.assign({},(0,r.ah)(),e.components);return s?(0,n.jsx)(s,Object.assign({},e,{children:(0,n.jsx)(d,e)})):d(e)}},1021:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/27-interactive-failures-e22e3b31b285188ed65f6432cb21df30.png"},1670:(e,s,t)=>{t.d(s,{Zo:()=>a,ah:()=>i});var n=t(7378);const r=n.createContext({});function i(e){const s=n.useContext(r);return n.useMemo((()=>"function"==typeof e?e(s):{...s,...e}),[s,e])}const o={};function a({components:e,children:s,disableParentContext:t}){let a;return a=t?"function"==typeof e?e({}):e||o:i(e),n.createElement(r.Provider,{value:a},s)}}}]);