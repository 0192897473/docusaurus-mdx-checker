"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[8227],{595:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>i});var t=o(4246),s=o(1670);const l={id:"es6-class-mocks",title:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0456\u0432 ES6"},c=void 0,r={unversionedId:"es6-class-mocks",id:"version-29.5/es6-class-mocks",title:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0456\u0432 ES6",description:"Jest \u043c\u043e\u0436\u0435 \u0437\u0430\u0441\u0442\u043e\u0441\u043e\u0432\u0443\u0432\u0430\u0442\u0438\u0441\u044c \u0434\u043b\u044f \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0456\u0432 ES6, \u044f\u043a\u0456 \u0456\u043c\u043f\u043e\u0440\u0442\u0443\u044e\u0442\u044c\u0441\u044f \u0443 \u0444\u0430\u0439\u043b\u0438, \u0449\u043e \u043f\u0456\u0434\u043b\u044f\u0433\u0430\u044e\u0442\u044c \u0442\u0435\u0441\u0442\u0443\u0432\u0430\u043d\u043d\u044e.",source:"@site/i18n/uk/docusaurus-plugin-content-docs/version-29.5/Es6ClassMocks.md",sourceDirName:".",slug:"/es6-class-mocks",permalink:"/uk/docs/29.5/es6-class-mocks",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/project/jest-v2/uk",tags:[],version:"29.5",frontMatter:{id:"es6-class-mocks",title:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0456\u0432 ES6"},sidebar:"docs",previous:{title:"\u0420\u0443\u0447\u043d\u0456 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457",permalink:"/uk/docs/29.5/manual-mocks"},next:{title:"\u041f\u0456\u0434\u043c\u0456\u043d\u0430 \u043c\u043e\u0434\u0443\u043b\u0456\u0432",permalink:"/uk/docs/29.5/bypassing-module-mocks"}},a={},i=[{value:"\u041f\u0440\u0438\u043a\u043b\u0430\u0434 ES6 \u043a\u043b\u0430\u0441\u0443",id:"\u043f\u0440\u0438\u043a\u043b\u0430\u0434-es6-\u043a\u043b\u0430\u0441\u0443",level:2},{value:"4 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0443 ES6",id:"4-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u043a\u043b\u0430\u0441\u0443-es6",level:2},{value:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f",id:"\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f",level:3},{value:"\u0420\u0443\u0447\u043d\u0456 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457",id:"\u0440\u0443\u0447\u043d\u0456-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457",level:3},{value:"\u0412\u0438\u043a\u043b\u0438\u043a <code>jest.mock()</code> \u0437 \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u043c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c \u043c\u043e\u0434\u0443\u043b\u044f",id:"\u0432\u0438\u043a\u043b\u0438\u043a-jestmock-\u0437-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u043c-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c-\u043c\u043e\u0434\u0443\u043b\u044f",level:3},{value:"\u0417\u0430\u043c\u0456\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u0437 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f\u043c <code>mockImplementation()</code> \u0430\u0431\u043e <code>mockImplementationOnce()</code>",id:"\u0437\u0430\u043c\u0456\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u0437-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f\u043c-mockimplementation-\u0430\u0431\u043e-mockimplementationonce",level:3},{value:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u0444\u0443\u043d\u043a\u0446\u0456\u0439-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0456\u0432 \u0443 \u0434\u0435\u0442\u0430\u043b\u044f\u0445",id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u0444\u0443\u043d\u043a\u0446\u0456\u0439-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0456\u0432-\u0443-\u0434\u0435\u0442\u0430\u043b\u044f\u0445",level:2},{value:"\u0420\u0443\u0447\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f, \u0449\u043e \u0441\u0430\u043c\u0430 \u0454 \u043a\u043b\u0430\u0441\u043e\u043c ES6",id:"\u0440\u0443\u0447\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u0449\u043e-\u0441\u0430\u043c\u0430-\u0454-\u043a\u043b\u0430\u0441\u043e\u043c-es6",level:3},{value:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u0437\u0430 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432 \u043c\u043e\u0434\u0443\u043b\u044f",id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u0437\u0430-\u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u0445-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432-\u043c\u043e\u0434\u0443\u043b\u044f",level:3},{value:"* \u0424\u0443\u043d\u043a\u0446\u0456\u044f \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \u043f\u043e\u0432\u0438\u043d\u043d\u0430 \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0442\u0438 \u0444\u0443\u043d\u043a\u0446\u0456\u044e",id:"-\u0444\u0443\u043d\u043a\u0446\u0456\u044f-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u043e\u0433\u043e-\u043c\u043e\u0434\u0443\u043b\u044f-\u043f\u043e\u0432\u0438\u043d\u043d\u0430-\u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0442\u0438-\u0444\u0443\u043d\u043a\u0446\u0456\u044e",level:4},{value:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u043f\u0435\u0432\u043d\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0443 \u043a\u043b\u0430\u0441\u0443",id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u043f\u0435\u0432\u043d\u043e\u0433\u043e-\u043c\u0435\u0442\u043e\u0434\u0443-\u043a\u043b\u0430\u0441\u0443",level:2},{value:"\u0421\u0442\u0430\u0442\u0438\u0447\u043d\u0456 \u043c\u0435\u0442\u043e\u0434\u0438, getter \u0442\u0430 setter",id:"\u0441\u0442\u0430\u0442\u0438\u0447\u043d\u0456-\u043c\u0435\u0442\u043e\u0434\u0438-getter-\u0442\u0430-setter",level:3},{value:"Keeping track of usage (spying on the mock)",id:"keeping-track-of-usage-spying-on-the-mock",level:2},{value:"Spying on the constructor",id:"spying-on-the-constructor",level:3},{value:"Mocking non-default class exports",id:"mocking-non-default-class-exports",level:3},{value:"Spying on methods of our class",id:"spying-on-methods-of-our-class",level:3},{value:"Cleaning up between tests",id:"cleaning-up-between-tests",level:3},{value:"Complete example",id:"complete-example",level:2}];function d(e){const n=Object.assign({p:"p",a:"a",h2:"h2",code:"code",pre:"pre",h3:"h3",admonition:"admonition",em:"em",strong:"strong",h4:"h4"},(0,s.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Jest \u043c\u043e\u0436\u0435 \u0437\u0430\u0441\u0442\u043e\u0441\u043e\u0432\u0443\u0432\u0430\u0442\u0438\u0441\u044c \u0434\u043b\u044f \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0456\u0432 ES6, \u044f\u043a\u0456 \u0456\u043c\u043f\u043e\u0440\u0442\u0443\u044e\u0442\u044c\u0441\u044f \u0443 \u0444\u0430\u0439\u043b\u0438, \u0449\u043e \u043f\u0456\u0434\u043b\u044f\u0433\u0430\u044e\u0442\u044c \u0442\u0435\u0441\u0442\u0443\u0432\u0430\u043d\u043d\u044e."}),"\n",(0,t.jsxs)(n.p,{children:["ES6 \u043a\u043b\u0430\u0441\u0438 - \u0446\u0435 \u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0438 \u0437 \u0434\u0435\u044f\u043a\u0438\u043c \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0447\u043d\u0438\u043c \u0446\u0443\u043a\u0440\u043e\u043c. \u0422\u043e\u043c\u0443, \u0431\u0443\u0434\u044c-\u044f\u043a\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u043a\u043b\u0430\u0441\u0443 ES6 \u043f\u043e\u0432\u0438\u043d\u043d\u0430 \u0431\u0443\u0442\u0438 \u0444\u0443\u043d\u043a\u0446\u0456\u0454\u044e \u0430\u0431\u043e \u043a\u043b\u0430\u0441\u043e\u043c ES6 (\u044f\u043a\u0438\u0439, \u0437\u043d\u043e\u0432\u0443 \u0436 \u0442\u0430\u043a\u0438, \u0454 \u0444\u0443\u043d\u043a\u0446\u0456\u0454\u044e). \u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0456\u043c\u0456\u0442\u0443\u0432\u0430\u0442\u0438 \u0457\u0445 \u0437\u0430 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/mock-functions",children:"\u0444\u0443\u043d\u043a\u0446\u0456\u0439-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0439"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"\u043f\u0440\u0438\u043a\u043b\u0430\u0434-es6-\u043a\u043b\u0430\u0441\u0443",children:"\u041f\u0440\u0438\u043a\u043b\u0430\u0434 ES6 \u043a\u043b\u0430\u0441\u0443"}),"\n",(0,t.jsxs)(n.p,{children:["\u041c\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u0454\u043c\u043e \u0441\u043f\u0435\u0446\u0456\u0430\u043b\u044c\u043d\u0438\u0439 \u043f\u0440\u0438\u043a\u043b\u0430\u0434 \u043a\u043b\u0430\u0441\u0443, \u044f\u043a\u0438\u0439 \u0432\u0456\u0434\u0442\u0432\u043e\u0440\u044e\u0454 \u0437\u0432\u0443\u043a\u043e\u0432\u0456 \u0444\u0430\u0439\u043b\u0438, ",(0,t.jsx)(n.code,{children:"SoundPlayer"})," \u0456 \u043a\u043b\u0430\u0441 ",(0,t.jsx)(n.code,{children:"SoundPlayerConsumer"}),", \u044f\u043a\u0438\u0439 \u0439\u043e\u0433\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454. \u041c\u0438 \u0456\u043c\u0456\u0442\u0443\u0432\u0430\u0442\u0438\u043c\u0435\u043c\u043e ",(0,t.jsx)(n.code,{children:"SoundPlayer"})," \u0432 \u043d\u0430\u0448\u0438\u0445 \u0442\u0435\u0441\u0442\u0430\u0445 \u0434\u043b\u044f ",(0,t.jsx)(n.code,{children:"SoundPlayerConsumer"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="sound-player.js"',children:"export default class SoundPlayer {\n  constructor() {\n    this.foo = 'bar';\n  }\n\n  playSoundFile(fileName) {\n    console.log('Playing sound file ' + fileName);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="sound-player-consumer.js"',children:"import SoundPlayer from './sound-player';\n\nexport default class SoundPlayerConsumer {\n  constructor() {\n    this.soundPlayer = new SoundPlayer();\n  }\n\n  playSomethingCool() {\n    const coolSoundFileName = 'song.mp3';\n    this.soundPlayer.playSoundFile(coolSoundFileName);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-\u0441\u043f\u043e\u0441\u043e\u0431\u0438-\u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u043a\u043b\u0430\u0441\u0443-es6",children:"4 \u0441\u043f\u043e\u0441\u043e\u0431\u0438 \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u043d\u044f \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u043a\u043b\u0430\u0441\u0443 ES6"}),"\n",(0,t.jsx)(n.h3,{id:"\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f",children:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f"}),"\n",(0,t.jsxs)(n.p,{children:["\u0412\u0438\u043a\u043b\u0438\u043a ",(0,t.jsx)(n.code,{children:"jest.mock('./sound-player')"}),' \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0454 \u043a\u043e\u0440\u0438\u0441\u043d\u0443 "\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0443 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044e", \u044f\u043a\u0443 \u043c\u043e\u0436\u043d\u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0434\u043b\u044f \u0441\u043b\u0456\u0434\u043a\u0443\u0432\u0430\u043d\u043d\u044f \u0437\u0430 \u0432\u0438\u043a\u043b\u0438\u043a\u0430\u043c\u0438 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0443 \u043a\u043b\u0430\u0441\u0456\u0432 \u0456 \u0432\u0441\u0456\u043c\u0430 \u0439\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0430\u043c\u0438. \u0412\u0456\u043d \u0437\u0430\u043c\u0456\u043d\u044e\u0454 \u043a\u043b\u0430\u0441 ES6 \u043d\u0430 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044e \u0442\u0430 \u0437\u0430\u043c\u0456\u043d\u044e\u0454 \u0432\u0441\u0456 \u0439\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0438 \u043d\u0430 ',(0,t.jsx)(n.a,{href:"/uk/docs/29.5/mock-functions",children:"\u0444\u0443\u043d\u043a\u0446\u0456\u0457-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457"}),", \u044f\u043a\u0456 \u0437\u0430\u0432\u0436\u0434\u0438 \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u044e\u0442\u044c ",(0,t.jsx)(n.code,{children:"undefined"}),". \u0412\u0438\u043a\u043b\u0438\u043a\u0438 \u043c\u0435\u0442\u043e\u0434\u0456\u0432 \u0437\u0431\u0435\u0440\u0456\u0433\u0430\u044e\u0442\u044c\u0441\u044f \u0432 ",(0,t.jsx)(n.code,{children:"theAutomaticMock.mock.instances[index].methodName.mock.calls"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["\u042f\u043a\u0449\u043e \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0441\u0442\u0440\u0456\u043b\u043a\u043e\u0432\u0456 \u0444\u0443\u043d\u043a\u0446\u0456\u0457 \u0443 \u0432\u0430\u0448\u0438\u0445 \u043a\u043b\u0430\u0441\u0430\u0445, \u0432\u043e\u043d\u0438 ",(0,t.jsx)(n.em,{children:"\u043d\u0435"})," \u0431\u0443\u0434\u0443\u0442\u044c \u0447\u0430\u0441\u0442\u0438\u043d\u043e\u044e \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457. The reason for that is that arrow functions are not present on the object's prototype, they are merely properties holding a reference to a function."]})}),"\n",(0,t.jsx)(n.p,{children:"If you don't need to replace the implementation of the class, this is the easiest option to set up. \u041d\u0430\u043f\u0440\u0438\u043a\u043b\u0430\u0434:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\nimport SoundPlayerConsumer from './sound-player-consumer';\njest.mock('./sound-player'); // SoundPlayer is now a mock constructor\n\nbeforeEach(() => {\n  // \u041e\u0447\u0438\u0441\u0442\u0438\u043c\u043e \u0432\u0441\u0456 \u0435\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0438 \u0442\u0430 \u0432\u0438\u043a\u043b\u0438\u043a\u0438 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0443 \u0442\u0430 \u0432\u0441\u0456\u0445 \u043c\u0435\u0442\u043e\u0434\u0456\u0432:\n  SoundPlayer.mockClear();\n});\n\nit('We can check if the consumer called the class constructor', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  expect(SoundPlayer).toHaveBeenCalledTimes(1);\n});\n\nit('We can check if the consumer called a method on the class instance', () => {\n  // \u041f\u043e\u043a\u0430\u0436\u0435\u043c\u043e, \u0449\u043e mockClear() \u043f\u0440\u0430\u0446\u044e\u0454:\n  expect(SoundPlayer).not.toHaveBeenCalled();\n\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  // \u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u043c\u0430\u0432 \u0437\u043d\u043e\u0432\u0443 \u0431\u0443\u0442\u0438 \u0432\u0438\u043a\u043b\u0438\u043a\u0430\u043d\u0438\u0439:\n  expect(SoundPlayer).toHaveBeenCalledTimes(1);\n\n  const coolSoundFileName = 'song.mp3';\n  soundPlayerConsumer.playSomethingCool();\n\n  // mock.instances \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0439 \u0437 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0438\u043c\u0438 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f\u043c\u0438:\n  const mockSoundPlayerInstance = SoundPlayer.mock.instances[0];\n  const mockPlaySoundFile = mockSoundPlayerInstance.playSoundFile;\n  expect(mockPlaySoundFile.mock.calls[0][0]).toBe(coolSoundFileName);\n  // \u041f\u0435\u0440\u0435\u0432\u0456\u0440\u043a\u0430, \u0430\u043d\u0430\u043b\u043e\u0433\u0456\u0447\u043d\u0430 \u0432\u0438\u0449\u0435\u0437\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0456\u0439:\n  expect(mockPlaySoundFile).toHaveBeenCalledWith(coolSoundFileName);\n  expect(mockPlaySoundFile).toHaveBeenCalledTimes(1);\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u0440\u0443\u0447\u043d\u0456-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457",children:"\u0420\u0443\u0447\u043d\u0456 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457"}),"\n",(0,t.jsxs)(n.p,{children:["Create a ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/manual-mocks",children:"manual mock"})," by saving a mock implementation in the ",(0,t.jsx)(n.code,{children:"__mocks__"})," folder. This allows you to specify the implementation, and it can be used across test files."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="__mocks__/sound-player.js"',children:"// \u0406\u043c\u043f\u043e\u0440\u0442\u0443\u0439\u0442\u0435 \u0446\u0435\u0439 \u0456\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0439 export \u0443 \u0432\u0430\u0448 \u0442\u0435\u0441\u0442\u043e\u0432\u0438\u0439 \u0444\u0430\u0439\u043b:\nexport const mockPlaySoundFile = jest.fn();\nconst mock = jest.fn().mockImplementation(() => {\n  return {playSoundFile: mockPlaySoundFile};\n});\n\nexport default mock;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Import the mock and the mock method shared by all instances:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="sound-player-consumer.test.js"',children:"import SoundPlayer, {mockPlaySoundFile} from './sound-player';\nimport SoundPlayerConsumer from './sound-player-consumer';\njest.mock('./sound-player'); // SoundPlayer \u0442\u0435\u043f\u0435\u0440 \u0454 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u043e\u043c-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0454\u044e\n\nbeforeEach(() => {\n  // \u041e\u0447\u0438\u0441\u0442\u0438\u043c\u043e \u0432\u0441\u0456 \u0435\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0438 \u0442\u0430 \u0432\u0438\u043a\u043b\u0438\u043a\u0438 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0443 \u0442\u0430 \u0432\u0441\u0456\u0445 \u043c\u0435\u0442\u043e\u0434\u0456\u0432:\n  SoundPlayer.mockClear();\n  mockPlaySoundFile.mockClear();\n});\n\nit('We can check if the consumer called the class constructor', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  expect(SoundPlayer).toHaveBeenCalledTimes(1);\n});\n\nit('We can check if the consumer called a method on the class instance', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  const coolSoundFileName = 'song.mp3';\n  soundPlayerConsumer.playSomethingCool();\n  expect(mockPlaySoundFile).toHaveBeenCalledWith(coolSoundFileName);\n});\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u0432\u0438\u043a\u043b\u0438\u043a-jestmock-\u0437-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u043c-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c-\u043c\u043e\u0434\u0443\u043b\u044f",children:["\u0412\u0438\u043a\u043b\u0438\u043a ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/jest-object#jestmockmodulename-factory-options",children:(0,t.jsx)(n.code,{children:"jest.mock()"})})," \u0437 \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u043c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c \u043c\u043e\u0434\u0443\u043b\u044f"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"jest.mock(path, moduleFactory)"})," takes a ",(0,t.jsx)(n.strong,{children:"module factory"})," argument. A module factory is a function that returns the mock."]}),"\n",(0,t.jsx)(n.p,{children:"In order to mock a constructor function, the module factory must return a constructor function. In other words, the module factory must be a function that returns a function - a higher-order function (HOF)."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\nconst mockPlaySoundFile = jest.fn();\njest.mock('./sound-player', () => {\n  return jest.fn().mockImplementation(() => {\n    return {playSoundFile: mockPlaySoundFile};\n  });\n});\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Since calls to ",(0,t.jsx)(n.code,{children:"jest.mock()"})," are hoisted to the top of the file, Jest prevents access to out-of-scope variables. By default, you cannot first define a variable and then use it in the factory. Jest will disable this check for variables that start with the word ",(0,t.jsx)(n.code,{children:"mock"}),". However, it is still up to you to guarantee that they will be initialized on time. Be aware of ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let#temporal_dead_zone_tdz",children:"Temporal Dead Zone"}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:["For example, the following will throw an out-of-scope error due to the use of ",(0,t.jsx)(n.code,{children:"fake"})," instead of ",(0,t.jsx)(n.code,{children:"mock"})," in the variable declaration."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u0417\u0432\u0435\u0440\u043d\u0456\u0442\u044c \u0443\u0432\u0430\u0433\u0443: \u0446\u0435\u0439 \u0432\u0430\u0440\u0456\u0430\u043d\u0442 \u043d\u0435 \u0441\u043f\u0440\u0430\u0446\u044e\u0454\nimport SoundPlayer from './sound-player';\nconst fakePlaySoundFile = jest.fn();\njest.mock('./sound-player', () => {\n  return jest.fn().mockImplementation(() => {\n    return {playSoundFile: fakePlaySoundFile};\n  });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The following will throw a ",(0,t.jsx)(n.code,{children:"ReferenceError"})," despite using ",(0,t.jsx)(n.code,{children:"mock"})," in the variable declaration, as the ",(0,t.jsx)(n.code,{children:"mockSoundPlayer"})," is not wrapped in an arrow function and thus accessed before initialization after hoisting."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\nconst mockSoundPlayer = jest.fn().mockImplementation(() => {\n  return {playSoundFile: mockPlaySoundFile};\n});\n// \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u043c \u0431\u0443\u0434\u0435 ReferenceError\njest.mock('./sound-player', () => {\n  return mockSoundPlayer;\n});\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"\u0437\u0430\u043c\u0456\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u0437-\u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f\u043c-mockimplementation-\u0430\u0431\u043e-mockimplementationonce",children:["\u0417\u0430\u043c\u0456\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u0437 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f\u043c ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/mock-function-api#mockfnmockimplementationfn",children:(0,t.jsx)(n.code,{children:"mockImplementation()"})})," \u0430\u0431\u043e ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/mock-function-api#mockfnmockimplementationoncefn",children:(0,t.jsx)(n.code,{children:"mockImplementationOnce()"})})]}),"\n",(0,t.jsxs)(n.p,{children:["You can replace all of the above mocks in order to change the implementation, for a single test or all tests, by calling ",(0,t.jsx)(n.code,{children:"mockImplementation()"})," on the existing mock."]}),"\n",(0,t.jsxs)(n.p,{children:["Calls to jest.mock are hoisted to the top of the code. You can specify a mock later, e.g. in ",(0,t.jsx)(n.code,{children:"beforeAll()"}),", by calling ",(0,t.jsx)(n.code,{children:"mockImplementation()"})," (or ",(0,t.jsx)(n.code,{children:"mockImplementationOnce()"}),") on the existing mock instead of using the factory parameter. This also allows you to change the mock between tests, if needed:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\nimport SoundPlayerConsumer from './sound-player-consumer';\n\njest.mock('./sound-player');\n\ndescribe('When SoundPlayer throws an error', () => {\n  beforeAll(() => {\n    SoundPlayer.mockImplementation(() => {\n      return {\n        playSoundFile: () => {\n          throw new Error('Test error');\n        },\n      };\n    });\n  });\n\n  it('Should throw an error when calling playSomethingCool', () => {\n    const soundPlayerConsumer = new SoundPlayerConsumer();\n    expect(() => soundPlayerConsumer.playSomethingCool()).toThrow();\n  });\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457-\u0444\u0443\u043d\u043a\u0446\u0456\u0439-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0456\u0432-\u0443-\u0434\u0435\u0442\u0430\u043b\u044f\u0445",children:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u0457 \u0444\u0443\u043d\u043a\u0446\u0456\u0439-\u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440\u0456\u0432 \u0443 \u0434\u0435\u0442\u0430\u043b\u044f\u0445"}),"\n",(0,t.jsxs)(n.p,{children:["Building your constructor function mock using ",(0,t.jsx)(n.code,{children:"jest.fn().mockImplementation()"})," makes mocks appear more complicated than they really are. This section shows how you can create your own mocks to illustrate how mocking works."]}),"\n",(0,t.jsx)(n.h3,{id:"\u0440\u0443\u0447\u043d\u0430-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u0449\u043e-\u0441\u0430\u043c\u0430-\u0454-\u043a\u043b\u0430\u0441\u043e\u043c-es6",children:"\u0420\u0443\u0447\u043d\u0430 \u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f, \u0449\u043e \u0441\u0430\u043c\u0430 \u0454 \u043a\u043b\u0430\u0441\u043e\u043c ES6"}),"\n",(0,t.jsxs)(n.p,{children:["If you define an ES6 class using the same filename as the mocked class in the ",(0,t.jsx)(n.code,{children:"__mocks__"})," folder, it will serve as the mock. This class will be used in place of the real class. This allows you to inject a test implementation for the class, but does not provide a way to spy on calls."]}),"\n",(0,t.jsx)(n.p,{children:"For the contrived example, the mock might look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="__mocks__/sound-player.js"',children:"export default class SoundPlayer {\n  constructor() {\n    console.log('Mock SoundPlayer: constructor was called');\n  }\n\n  playSoundFile() {\n    console.log('Mock SoundPlayer: playSoundFile was called');\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u0437\u0430-\u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u0445-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432-\u043c\u043e\u0434\u0443\u043b\u044f",children:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u0437\u0430 \u0434\u043e\u043f\u043e\u043c\u043e\u0433\u043e\u044e \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u0438\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0456\u0432 \u043c\u043e\u0434\u0443\u043b\u044f"}),"\n",(0,t.jsxs)(n.p,{children:["The module factory function passed to ",(0,t.jsx)(n.code,{children:"jest.mock(path, moduleFactory)"})," can be a HOF that returns a function*. This will allow calling ",(0,t.jsx)(n.code,{children:"new"})," on the mock. Again, this allows you to inject different behavior for testing, but does not provide a way to spy on calls."]}),"\n",(0,t.jsx)(n.h4,{id:"-\u0444\u0443\u043d\u043a\u0446\u0456\u044f-\u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u043e\u0433\u043e-\u043c\u043e\u0434\u0443\u043b\u044f-\u043f\u043e\u0432\u0438\u043d\u043d\u0430-\u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0442\u0438-\u0444\u0443\u043d\u043a\u0446\u0456\u044e",children:"* \u0424\u0443\u043d\u043a\u0446\u0456\u044f \u0437\u0430\u0432\u043e\u0434\u0441\u044c\u043a\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \u043f\u043e\u0432\u0438\u043d\u043d\u0430 \u043f\u043e\u0432\u0435\u0440\u0442\u0430\u0442\u0438 \u0444\u0443\u043d\u043a\u0446\u0456\u044e"}),"\n",(0,t.jsx)(n.p,{children:"In order to mock a constructor function, the module factory must return a constructor function. In other words, the module factory must be a function that returns a function - a higher-order function (HOF)."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"jest.mock('./sound-player', () => {\n  return function () {\n    return {playSoundFile: () => {}};\n  };\n});\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u043d\u0435 \u043c\u043e\u0436\u0435 \u0431\u0443\u0442\u0438 \u0441\u0442\u0440\u0456\u043b\u043a\u043e\u0432\u043e\u044e \u0444\u0443\u043d\u043a\u0446\u0456\u0454\u044e, \u0442\u043e\u043c\u0443 \u0449\u043e \u0432 JavaScript \u0432\u0438\u043a\u043b\u0438\u043a ",(0,t.jsx)(n.code,{children:"new"})," \u0434\u043b\u044f \u0441\u0442\u0440\u0456\u043b\u043a\u043e\u0432\u043e\u0457 \u0444\u0443\u043d\u043a\u0446\u0456\u0457 \u043d\u0435 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u0454\u0442\u044c\u0441\u044f. So this won't work:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"jest.mock('./sound-player', () => {\n  return () => {\n    // Does not work; arrow functions can't be called with new\n    return {playSoundFile: () => {}};\n  };\n});\n"})}),(0,t.jsxs)(n.p,{children:["This will throw ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"TypeError: _soundPlayer2.default is not a constructor"})}),", unless the code is transpiled to ES5, e.g. by ",(0,t.jsx)(n.code,{children:"@babel/preset-env"}),". (ES5 doesn't have arrow functions nor classes, so both will be transpiled to plain functions.)"]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u044f-\u043f\u0435\u0432\u043d\u043e\u0433\u043e-\u043c\u0435\u0442\u043e\u0434\u0443-\u043a\u043b\u0430\u0441\u0443",children:"\u0406\u043c\u0456\u0442\u0430\u0446\u0456\u044f \u043f\u0435\u0432\u043d\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u0443 \u043a\u043b\u0430\u0441\u0443"}),"\n",(0,t.jsxs)(n.p,{children:["\u041f\u0440\u0438\u043f\u0443\u0441\u0442\u0438\u043c\u043e, \u0432\u0438 \u0445\u043e\u0447\u0435\u0442\u0435 \u0456\u043c\u0456\u0442\u0443\u0432\u0430\u0442\u0438 \u0430\u0431\u043e \u0441\u043b\u0456\u0434\u043a\u0443\u0432\u0430\u0442\u0438 \u0437\u0430 \u043c\u0435\u0442\u043e\u0434\u043e\u043c ",(0,t.jsx)(n.code,{children:"playSoundFile"})," \u0432\u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0456 \u043a\u043b\u0430\u0441\u0443 ",(0,t.jsx)(n.code,{children:"SoundPlayer"}),". A simple example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u0437\u043d\u0438\u0437\u0443 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0439 \u0432\u0430\u0448 \u0442\u0435\u0441\u0442\u043e\u0432\u0438\u0439 jest \u0444\u0430\u0439\u043b\nimport SoundPlayer from './sound-player';\nimport SoundPlayerConsumer from './sound-player-consumer';\n\nconst playSoundFileMock = jest\n  .spyOn(SoundPlayer.prototype, 'playSoundFile')\n  .mockImplementation(() => {\n    console.log('mocked function');\n  }); // \u0437\u0430\u043a\u043e\u043c\u0435\u043d\u0442\u0443\u0439\u0442\u0435 \u0446\u0435\u0439 \u0440\u044f\u0434\u043e\u043a, \u044f\u043a\u0449\u043e \u043f\u043e\u0442\u0440\u0456\u0431\u043d\u0435 \u043b\u0438\u0448\u0435 \u0441\u043b\u0456\u0434\u043a\u0443\u0432\u0430\u043d\u043d\u044f\n\nit('player consumer plays music', () => {\n  const player = new SoundPlayerConsumer();\n  player.playSomethingCool();\n  expect(playSoundFileMock).toHaveBeenCalled();\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u0441\u0442\u0430\u0442\u0438\u0447\u043d\u0456-\u043c\u0435\u0442\u043e\u0434\u0438-getter-\u0442\u0430-setter",children:"\u0421\u0442\u0430\u0442\u0438\u0447\u043d\u0456 \u043c\u0435\u0442\u043e\u0434\u0438, getter \u0442\u0430 setter"}),"\n",(0,t.jsxs)(n.p,{children:["Lets imagine our class ",(0,t.jsx)(n.code,{children:"SoundPlayer"})," has a getter method ",(0,t.jsx)(n.code,{children:"foo"})," and a static method ",(0,t.jsx)(n.code,{children:"brand"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"export default class SoundPlayer {\n  constructor() {\n    this.foo = 'bar';\n  }\n\n  playSoundFile(fileName) {\n    console.log('Playing sound file ' + fileName);\n  }\n\n  get foo() {\n    return 'bar';\n  }\n  static brand() {\n    return 'player-brand';\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u0412\u0438 \u043c\u043e\u0436\u0435\u0442\u0435 \u0437 \u043b\u0435\u0433\u043a\u0456\u0441\u0442\u044e \u0456\u043c\u0456\u0442\u0443\u0432\u0430\u0442\u0438/\u0441\u043b\u0456\u0434\u043a\u0443\u0432\u0430\u0442\u0438 \u0437\u0430 \u043d\u0438\u043c\u0438, \u044f\u043a \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u043e \u0432 \u043f\u0440\u0438\u043a\u043b\u0430\u0434\u0456:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// your jest test file below\nimport SoundPlayer from './sound-player';\n\nconst staticMethodMock = jest\n  .spyOn(SoundPlayer, 'brand')\n  .mockImplementation(() => 'some-mocked-brand');\n\nconst getterMethodMock = jest\n  .spyOn(SoundPlayer.prototype, 'foo', 'get')\n  .mockImplementation(() => 'some-mocked-result');\n\nit('custom methods are called', () => {\n  const player = new SoundPlayer();\n  const foo = player.foo;\n  const brand = SoundPlayer.brand();\n\n  expect(staticMethodMock).toHaveBeenCalled();\n  expect(getterMethodMock).toHaveBeenCalled();\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"keeping-track-of-usage-spying-on-the-mock",children:"Keeping track of usage (spying on the mock)"}),"\n",(0,t.jsx)(n.p,{children:"Injecting a test implementation is helpful, but you will probably also want to test whether the class constructor and methods are called with the correct parameters."}),"\n",(0,t.jsx)(n.h3,{id:"spying-on-the-constructor",children:"Spying on the constructor"}),"\n",(0,t.jsxs)(n.p,{children:["In order to track calls to the constructor, replace the function returned by the HOF with a Jest mock function. Create it with ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/jest-object#jestfnimplementation",children:(0,t.jsx)(n.code,{children:"jest.fn()"})}),", and then specify its implementation with ",(0,t.jsx)(n.code,{children:"mockImplementation()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\njest.mock('./sound-player', () => {\n  // Works and lets you check for constructor calls:\n  return jest.fn().mockImplementation(() => {\n    return {playSoundFile: () => {}};\n  });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u0426\u0435 \u0434\u043e\u0437\u0432\u043e\u043b\u0438\u0442\u044c \u043d\u0430\u043c \u043f\u0435\u0440\u0435\u0432\u0456\u0440\u0438\u0442\u0438 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u0430\u043d\u043d\u044f \u043d\u0430\u0448\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0443-\u0456\u043c\u0456\u0442\u0430\u0446\u0456\u0457, \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u044e\u0447\u0438 ",(0,t.jsx)(n.code,{children:"SoundPlayer.mock.calls"}),": ",(0,t.jsx)(n.code,{children:"expect(SoundPlayer).toHaveBeenCalled();"})," \u0430\u0431\u043e \u043c\u0430\u0439\u0436\u0435 \u0456\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u0438\u0439: ",(0,t.jsx)(n.code,{children:"expect(Sounder.mock.calls.length).toBeGreaterThan(0);"})]}),"\n",(0,t.jsx)(n.h3,{id:"mocking-non-default-class-exports",children:"Mocking non-default class exports"}),"\n",(0,t.jsxs)(n.p,{children:["If the class is ",(0,t.jsx)(n.strong,{children:"not"})," the default export from the module then you need to return an object with the key that is the same as the class export name."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import {SoundPlayer} from './sound-player';\njest.mock('./sound-player', () => {\n  // Works and lets you check for constructor calls:\n  return {\n    SoundPlayer: jest.fn().mockImplementation(() => {\n      return {playSoundFile: () => {}};\n    }),\n  };\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"spying-on-methods-of-our-class",children:"Spying on methods of our class"}),"\n",(0,t.jsxs)(n.p,{children:["Our mocked class will need to provide any member functions (",(0,t.jsx)(n.code,{children:"playSoundFile"})," in the example) that will be called during our tests, or else we'll get an error for calling a function that doesn't exist. But we'll probably want to also spy on calls to those methods, to ensure that they were called with the expected parameters."]}),"\n",(0,t.jsxs)(n.p,{children:["A new object will be created each time the mock constructor function is called during tests. To spy on method calls in all of these objects, we populate ",(0,t.jsx)(n.code,{children:"playSoundFile"})," with another mock function, and store a reference to that same mock function in our test file, so it's available during tests."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import SoundPlayer from './sound-player';\nconst mockPlaySoundFile = jest.fn();\njest.mock('./sound-player', () => {\n  return jest.fn().mockImplementation(() => {\n    return {playSoundFile: mockPlaySoundFile};\n    // Now we can track calls to playSoundFile\n  });\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"The manual mock equivalent of this would be:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="__mocks__/sound-player.js"',children:"// \u0406\u043c\u043f\u043e\u0440\u0442\u0443\u0439\u0442\u0435 \u0446\u0435\u0439 \u0456\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0439 export \u0443 \u0432\u0430\u0448 \u0442\u0435\u0441\u0442\u043e\u0432\u0438\u0439 \u0444\u0430\u0439\u043b:\nexport const mockPlaySoundFile = jest.fn();\nconst mock = jest.fn().mockImplementation(() => {\n  return {playSoundFile: mockPlaySoundFile};\n});\n\nexport default mock;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Usage is similar to the module factory function, except that you can omit the second argument from ",(0,t.jsx)(n.code,{children:"jest.mock()"}),", and you must import the mocked method into your test file, since it is no longer defined there. Use the original module path for this; don't include ",(0,t.jsx)(n.code,{children:"__mocks__"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"cleaning-up-between-tests",children:"Cleaning up between tests"}),"\n",(0,t.jsxs)(n.p,{children:["To clear the record of calls to the mock constructor function and its methods, we call ",(0,t.jsx)(n.a,{href:"/uk/docs/29.5/mock-function-api#mockfnmockclear",children:(0,t.jsx)(n.code,{children:"mockClear()"})})," in the ",(0,t.jsx)(n.code,{children:"beforeEach()"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"beforeEach(() => {\n  SoundPlayer.mockClear();\n  mockPlaySoundFile.mockClear();\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete example"}),"\n",(0,t.jsxs)(n.p,{children:["Here's a complete test file which uses the module factory parameter to ",(0,t.jsx)(n.code,{children:"jest.mock"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",metastring:'title="sound-player-consumer.test.js"',children:"import SoundPlayer from './sound-player';\nimport SoundPlayerConsumer from './sound-player-consumer';\n\nconst mockPlaySoundFile = jest.fn();\njest.mock('./sound-player', () => {\n  return jest.fn().mockImplementation(() => {\n    return {playSoundFile: mockPlaySoundFile};\n  });\n});\n\nbeforeEach(() => {\n  SoundPlayer.mockClear();\n  mockPlaySoundFile.mockClear();\n});\n\nit('The consumer should be able to call new() on SoundPlayer', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  // \u041f\u0435\u0440\u0435\u043a\u043e\u043d\u0443\u0454\u043c\u043e\u0441\u044c, \u0449\u043e \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u0441\u0442\u0432\u043e\u0440\u0438\u0432 \u043e\u0431'\u0454\u043a\u0442:\n  expect(soundPlayerConsumer).toBeTruthy();\n});\n\nit('We can check if the consumer called the class constructor', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  expect(SoundPlayer).toHaveBeenCalledTimes(1);\n});\n\nit('We can check if the consumer called a method on the class instance', () => {\n  const soundPlayerConsumer = new SoundPlayerConsumer();\n  const coolSoundFileName = 'song.mp3';\n  soundPlayerConsumer.playSomethingCool();\n  expect(mockPlaySoundFile.mock.calls[0][0]).toBe(coolSoundFileName);\n});\n"})})]})}const u=function(e={}){const{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(d,e)})):d(e)}},1670:(e,n,o)=>{o.d(n,{Zo:()=>r,ah:()=>l});var t=o(7378);const s=t.createContext({});function l(e){const n=t.useContext(s);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const c={};function r({components:e,children:n,disableParentContext:o}){let r;return r=o?"function"==typeof e?e({}):e||c:l(e),t.createElement(s.Provider,{value:r},n)}}}]);